
<!DOCTYPE html>

<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø©</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&amp;display=swap" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
        }
        
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --sidebar-width: 280px;
            --header-height: 70px;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e7eb 100%);
            color: #333;
            direction: rtl;
            min-height: 100vh;
        }
        
        /* ØªØ®Ø·ÙŠØ· Ø§Ù„ØµÙØ­Ø© */
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--primary), #1a2530);
            color: white;
            height: 100vh;
            position: fixed;
            overflow-y: auto;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }
        
        .sidebar-header {
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .sidebar-header h2 {
            font-weight: 700;
            font-size: 1.5rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .sidebar-header p {
            opacity: 0.8;
            font-size: 0.9rem;
        }
        
        .dept-list {
            padding: 15px 0;
        }
        
        .dept-item {
            padding: 15px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .dept-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
            padding-right: 30px;
        }
        
        .dept-item.active {
            background-color: var(--secondary);
            border-right: 4px solid white;
        }
        
        .dept-item i {
            font-size: 1.2rem;
        }
        
        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .main-content {
            flex: 1;
            margin-right: var(--sidebar-width);
            padding: 20px;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            color: var(--primary);
            font-weight: 700;
            font-size: 1.8rem;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: white;
        }
        
        .btn-pdf {
            background-color: #d32f2f;
            color: white;
        }
        
        .btn-edit {
            background-color: #9b59b6;
            color: white;
        }
        
        .btn-backup {
            background-color: #16a085;
            color: white;
        }
        
        .btn-update {
            background-color: #8e44ad;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }
        
        /* Ù‚Ø³Ù… Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª */
        .input-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .input-row {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .input-group {
            flex: 1;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .input-group input:focus, .input-group select:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        
        .serial-number {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            padding: 12px 15px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--secondary);
        }
        
        /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø±ÙƒØ§Øª */
        .movements-table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
        }
        
        .movements-table th {
            background-color: var(--primary);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 500;
        }
        
        .movements-table td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        
        .movements-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .movements-table tr:hover {
            background-color: #f1f9ff;
        }
        
        .movements-table input, .movements-table select {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.95rem;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        
        .action-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }
        
        .action-btn.edit {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--secondary);
        }
        
        .action-btn.delete {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--danger);
        }
        
        .action-btn.print {
            background-color: rgba(155, 89, 182, 0.1);
            color: #9b59b6;
        }
        
        .action-btn.pdf {
            background-color: rgba(211, 47, 47, 0.1);
            color: #d32f2f;
        }
        
        .action-btn.load {
            background-color: rgba(155, 89, 182, 0.1);
            color: #8e44ad;
        }
        
        .action-btn:hover {
            transform: scale(1.05);
        }
        
        /* Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ */
        .summary-section {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin-top: 30px;
        }
        
        .summary-box {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .summary-box:hover {
            transform: translateY(-5px);
        }
        
        .summary-box h3 {
            font-size: 1rem;
            margin-bottom: 15px;
            color: var(--dark);
            font-weight: 600;
        }
        
        .summary-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .total-amount {
            color: var(--primary);
        }
        
        .required-amount {
            color: var(--secondary);
        }
        
        .difference-amount.positive {
            color: var(--success);
        }
        
        .difference-amount.negative {
            color: var(--danger);
        }
        
        .suspended-total {
            color: #9b59b6;
        }
        
        .status-box {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 8px;
            border-radius: 30px;
            font-weight: 600;
        }
        
        .status-match {
            background-color: rgba(39, 174, 96, 0.15);
            color: var(--success);
        }
        
        .status-excess {
            background-color: rgba(243, 156, 18, 0.15);
            color: var(--warning);
        }
        
        .status-shortage {
            background-color: rgba(231, 76, 60, 0.15);
            color: var(--danger);
        }
        
        .footer-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        /* Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø£Ø®Ø±Ù‰ */
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        .print-window {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            z-index: 2000;
            padding: 20px;
            overflow: auto;
        }
        
        .print-content {
            background: white;
            width: 90%;
            max-width: 1000px;
            margin: 40px auto;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }
        
        .print-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }
        
        .print-header h2 {
            color: var(--primary);
            font-size: 1.8rem;
            margin-bottom: 10px;
            background-color: #f0f8ff;
            padding: 10px;
            border-radius: 8px;
        }
        
        .print-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--danger);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            z-index: 2100;
        }
        
        .print-footer {
            text-align: center;
            margin-top: 25px;
            padding-top: 15px;
            border-top: 2px solid #eee;
            font-style: italic;
            color: #777;
            font-size: 0.9rem;
        }
        
        .print-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.9rem;
        }
        
        .print-table th {
            background-color: var(--primary);
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-weight: 500;
        }
        
        .print-table td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        
        .print-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .print-table tr:hover {
            background-color: #f1f1f1;
        }
        
        .print-total-row {
            background-color: #e8f4ff;
            font-weight: bold;
        }
        
        .print-table tr.print-highlight {
            background-color: #fff9e6;
        }
        
        /* ÙÙ„ØªØ± Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
        .filter-header {
            background-color: #f0f8ff;
            padding: 8px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .filter-icon {
            background-color: #3498db;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin: 0 5px;
        }
        
        .filter-icon:hover {
            background-color: #2980b9;
        }
        
        /* Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            display: none;
        }
        
        .loading-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        
        /* Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© */
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            height: 400px;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .chart-title {
            text-align: center;
            margin-bottom: 15px;
            color: var(--primary);
            font-weight: 700;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        .print-only {
            display: none;
        }
        
        .filtered-total {
            background-color: #e8f4ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-weight: bold;
            font-size: 1.2rem;
            text-align: center;
        }
        
        .analytics-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .analytics-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            text-align: center;
        }
        
        .analytics-card h3 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .analytics-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--secondary);
        }
        
        /* Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© */
        .backup-section {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            border: 1px dashed #3498db;
        }
        
        .backup-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .backup-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }
        
        .file-input-wrapper input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-input-btn {
            background-color: #9b59b6;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .file-input-btn:hover {
            background-color: #8e44ad;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù„Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© */
        @media print {
            body * {
                visibility: hidden;
            background: white;
            color: black;
            font-family: 'Tajawal', sans-serif;
            direction: rtl;
        }
            .print-window, .print-window * {
                visibility: visible;
            }
            .print-window {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: auto;
                background: white;
                padding: 0;
                margin: 0;
            }
            .print-content {
                width: 100%;
                max-width: 100%;
                margin: 0;
                padding: 15px;
                box-shadow: none;
                border-radius: 0;
            }
            .print-close {
                display: none;
            }
            .page-break {
                page-break-after: always;
            }
        }
        
        @media (max-width: 992px) {
            .sidebar {
                width: 80px;
            }
            
            .sidebar-header h2 span, .dept-item span {
                display: none;
            }
            
            .sidebar-header {
                padding: 15px 10px;
            }
            
            .dept-item {
                justify-content: center;
                padding: 15px 10px;
            }
            
            .main-content {
                margin-right: 80px;
            }
            
            .summary-section {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .print-content {
                width: 95%;
                padding: 20px;
            }
            
            .header-actions {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .analytics-summary {
                grid-template-columns: 1fr;
            }
            
            .backup-actions {
                flex-direction: column;
            }
        }
        
        @media (max-width: 768px) {
            .input-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .summary-section {
                grid-template-columns: 1fr;
            }
            
            .movements-table {
                font-size: 0.85rem;
            }
            
            .movements-table th, .movements-table td {
                padding: 8px 10px;
            }
            
            .action-buttons {
                flex-wrap: wrap;
            }
            
            .print-table {
                font-size: 0.8rem;
            }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Ø§Ù„ØªØ·ÙˆÙŠØ±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
        .login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 4000;
            justify-content: center;
            align-items: center;
        }
        
        .login-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        
        .login-content h2 {
            margin-bottom: 20px;
            color: var(--primary);
        }
        
        .login-content input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .login-content button {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
        }
        
        .notification {
            position: fixed;
            bottom: 30px;
            left: 30px;
            padding: 15px 25px;
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 3000;
            animation: fadeIn 0.3s, fadeOut 0.3s 2.7s;
        }
        
        .notification.success { background: #27ae60; }
        .notification.error { background: #e74c3c; }
        .notification.warning { background: #f39c12; }
        .notification.info { background: #3498db; }
        
        .attachment-preview {
            max-width: 100px;
            max-height: 100px;
            margin-top: 5px;
            cursor: pointer;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .dashboard-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        
        .recent-movements li {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }
        
        .exchange-update {
            background: #e1f5fe;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .attachment-cell {
            position: relative;
        }
        
        .attachment-btn {
            background: rgba(155, 89, 182, 0.1);
            color: #9b59b6;
            border: none;
            border-radius: 6px;
            padding: 5px 10px;
            cursor: pointer;
        }
        
        .attachment-input {
            display: none;
        }
        
        .user-info {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        /* Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
        .user-form {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #eee;
        }
        
        .user-form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .user-form-group {
            flex: 1;
        }
        
        .user-form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .password-toggler {
            background: #f0f0f0;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 0 5px 5px 0;
            cursor: pointer;
        }
        
        .password-container {
            display: flex;
        }
        
        .password-container input {
            border-radius: 5px 0 0 5px !important;
        }
        
        .user-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .user-table th {
            background-color: var(--primary);
            color: white;
            padding: 12px;
            text-align: center;
        }
        
        .user-table td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        
        .user-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .user-table tr:hover {
            background-color: #f1f1f1;
        }
        
        .role-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .role-admin {
            background-color: #e1f5fe;
            color: #0288d1;
        }
        
        .role-accountant {
            background-color: #e8f5e9;
            color: #388e3c;
        }
        
        .user-actions {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        
        .action-btn.change-password {
            background-color: rgba(0, 150, 136, 0.1);
            color: #009688;
        }
        
        /* Ø±Ø³ÙˆÙ… Ø¨ÙŠØ§Ù†ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© */
        .mini-chart {
            height: 200px;
            margin-top: 15px;
        }
        
        /* ÙÙ„ØªØ± Ù…ØªÙ‚Ø¯Ù… */
        .advanced-filters {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .advanced-filters label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .filter-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 15px;
        }
        
        /* Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
        .type-select {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 8px;
            width: 100%;
            font-size: 0.95rem;
        }
        
        .type-select:focus {
            border-color: var(--secondary);
            outline: none;
        }
    
.app-container.collapsed .sidebar {
    width: 60px;
}
.app-container.collapsed .main-content {
    margin-right: 60px;
}
.app-container.collapsed .sidebar-header h2 span,
.app-container.collapsed .dept-item span,
.app-container.collapsed .user-info {
    display: none;
}

</style>
</head>
<body>
<!-- Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div class="login-modal" id="login-modal">
<div class="login-content">
<h2><i class="fas fa-lock"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
<input id="login-username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" type="text"/>
<input id="login-password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" type="password"/>
<button id="login-btn">Ø¯Ø®ÙˆÙ„</button>
</div>
</div>
<div class="app-container">
<!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
<div class="sidebar">
<div class="sidebar-header">
<button id="toggle-sidebar" style="position:absolute;top:10px;left:10px;background:none;border:none;color:white;font-size:20px;cursor:pointer;">
<i class="fas fa-bars"></i>
</button>
<h2><i class="fas fa-chart-line"></i> <span>Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©</span></h2>
<p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</p>
<div class="user-info" id="user-info" style="display:none;">
<p><i class="fas fa-user"></i> <span id="current-user">Ù…Ø³ØªØ®Ø¯Ù…</span></p>
<p><i class="fas fa-user-tag"></i> <span id="current-role">Ù…Ø­Ø§Ø³Ø¨</span></p>
<button class="btn btn-danger" id="logout-btn" style="margin-top:10px; width:100%;">
<i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                    </button>
</div>
</div>
<div class="dept-list">
<div class="dept-item active" data-section="input">
<i class="fas fa-edit"></i>
<span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª</span>
</div>
<div class="dept-item" data-section="reports">
<i class="fas fa-database"></i>
<span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
</div>
<div class="dept-item" data-section="analytics">
<i class="fas fa-chart-pie"></i>
<span>Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø±Ø³ÙˆÙ…ÙŠØ©</span>
</div>
<div class="dept-item" data-section="detailed">
<i class="fas fa-file-alt"></i>
<span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©</span>
</div>
<div class="dept-item" data-section="dashboard">
<i class="fas fa-tachometer-alt"></i>
<span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
</div>
<div class="dept-item" data-section="users" id="users-section-item" style="display: none;">
<i class="fas fa-users-cog"></i>
<span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
</div>
<div class="dept-item"><a href="#backup-section"><i class="fas fa-save"></i><span style="color: white;">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</span></a></div></div>
</div>
<!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
<div class="main-content">
<!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª -->
<div class="section active" id="input-section">
<div class="header">
<h1><i class="fas fa-edit"></i> Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h1>
<div class="header-actions">
<button class="btn btn-primary" id="print-btn">
<i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                        </button>
<button class="btn btn-pdf" id="pdf-btn">
<i class="fas fa-file-pdf"></i> ØªØµØ¯ÙŠØ± PDF
                        </button>
<button class="btn btn-success" id="save-btn">
<i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø­Ø±ÙƒØ©
                        </button>
<button class="btn btn-primary" id="print-input-table-btn">
<i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
    </button>
</div>
</div>
<div class="input-section">
<div class="input-row">
<div class="input-group">
<label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</label>
<input id="employee-name" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù" type="text"/>
</div>
<div class="input-group">
<label>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
<input id="employee-note" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ù„Ø§Ø­Ø¸Ø§Øª" type="text"/>
</div>
<div class="input-group">
<label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø±ÙƒØ©</label>
<input id="movement-date" type="date"/>
</div>
<div class="input-group">
<label>Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„</label>
<div class="serial-number" id="serial-number">1</div>
</div>
</div>
<div id="date-filters" style="margin:20px 0;">
<label>Ù…Ù† ØªØ§Ø±ÙŠØ®:</label>
<input id="startDate" type="date"/>
<label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®:</label>
<input id="endDate" type="date"/>
<button class="btn btn-primary" onclick="filterByDate()">ØªØµÙÙŠØ©</button>
<button class="btn btn-warning" onclick="setPeriod('month')">Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</button>
<button class="btn btn-warning" onclick="setPeriod('quarter')">Ù‡Ø°Ø§ Ø§Ù„Ø±Ø¨Ø¹</button>
<button class="btn btn-warning" onclick="setPeriod('year')">Ù‡Ø°Ù‡ Ø§Ù„Ø³Ù†Ø©</button>
</div>
<table class="movements-table">
<thead>
<tr>
<th>#</th>
<th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
<th>Ø§Ù„Ø¹Ù…Ù„Ø©</th>
<th>Ø§Ù„Ø¨ÙŠØ§Ù† Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ</th>
<th>Ø§Ù„Ù†ÙˆØ¹</th>
<th>Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù</th>
<th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„ÙŠÙ…Ù†ÙŠ</th>
<th>Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª</th>
<th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
</tr>
</thead>
<tbody id="movements-body">
<tr>
<td>1</td>
<td><input class="amount-input" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" step="0.01" type="number" value="1000"/></td>
<td>
<select class="currency-select">
<option value="YER">Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ</option>
<option value="SAR">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</option>
<option value="USD">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ</option>
</select>
</td>
<td><input class="description-input" placeholder="Ø§Ù„Ø¨ÙŠØ§Ù†" type="text" value="Ù…ØµØ±ÙˆÙØ§Øª Ù…ÙƒØªØ¨ÙŠØ©"/></td>
<td>
<select class="type-select">
<option value="Ù…ÙˆØ¸ÙÙŠÙ†">Ù…ÙˆØ¸ÙÙŠÙ†</option>
<option value="Ù…Ø¹Ù„Ù‚Ø§Øª">Ù…Ø¹Ù„Ù‚Ø§Øª</option>
<option value="Ø³Ø¯Ø§Ø¯Ù…ÙˆØ±Ø¯ÙŠÙ†">Ø³Ø¯Ø§Ø¯Ù…ÙˆØ±Ø¯ÙŠÙ†</option>
<option value="Ù…ØµØ±ÙˆÙØ§Øª">Ù…ØµØ±ÙˆÙØ§Øª</option>
<option value="Ø§Ù„Ù…Ø¯ÙŠØ±">Ø§Ù„Ù…Ø¯ÙŠØ±</option>
<option value="ÙÙˆØ§ØªÙŠØ± Ù…Ø´ØªØ±ÙŠØ§Øª">ÙÙˆØ§ØªÙŠØ± Ù…Ø´ØªØ±ÙŠØ§Øª</option>
<option value="Ù†Ù‚Ø¯ÙŠÙ‡">Ù†Ù‚Ø¯ÙŠÙ‡</option>
<option value="Ø§Ø®Ø±Ù‰">Ø§Ø®Ø±Ù‰</option>
<option value="Ù…Ø³Ø³Ù„Ù… Ù…Ø¹Ù„Ù‚Ø§Øª Ø³Ø§Ø¨Ù‚Ù‡">Ù…Ø³Ø³Ù„Ù… Ù…Ø¹Ù„Ù‚Ø§Øª Ø³Ø§Ø¨Ù‚Ù‡</option>
</select>
</td>
<td><input class="exchange-input" disabled="" step="0.01" type="number" value="1"/></td>
<td class="total-cell">1000.00</td>
<td class="attachment-cell">
<button class="attachment-btn">
<i class="fas fa-paperclip"></i>
</button>
<input accept="image/*,.pdf" class="attachment-input" type="file"/>
<img class="attachment-preview" style="display:none"/>
</td>
<td class="action-buttons">
<button class="action-btn delete"><i class="fas fa-trash"></i></button>
</td>
</tr>
</tbody>
</table>
<button class="btn btn-primary" id="add-row-btn">
<i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø­Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø©
                    </button>
<div class="summary-section">
<div class="summary-box">
<h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø±ÙƒØ§Øª</h3>
<div class="summary-value total-amount" id="total-amount">1000.00 Ø±ÙŠØ§Ù„</div>
<p>Ø¨Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„ÙŠÙ…Ù†ÙŠ</p>
</div>
<div class="summary-box">
<h3>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</h3>
<input class="summary-value" id="required-amount" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº" step="0.01" type="number" value="1000"/>
<p>Ø¨Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„ÙŠÙ…Ù†ÙŠ</p>
</div>
<div class="summary-box">
<h3>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙØ§Ø±Ù‚</h3>
<div class="summary-value difference-amount" id="difference-amount">0.00 Ø±ÙŠØ§Ù„</div>
<p>Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„Ù…Ø·Ù„ÙˆØ¨</p>
</div>
<div class="summary-box">
<h3>Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§Ø±Ù‚</h3>
<div class="status-box status-match" id="status-box">Ù…Ø·Ø§Ø¨Ù‚</div>
<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙØ±Ù‚</p>
</div>
<!-- Ø­Ù‚Ù„ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª -->
<div class="summary-box">
<h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª</h3>
<div class="summary-value suspended-total" id="suspended-total">0.00 Ø±ÙŠØ§Ù„</div>
<p>Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</p>
</div>
</div>
<div class="footer-actions">
<button class="btn btn-success" id="confirm-save-btn">
<i class="fas fa-check-circle"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­ÙØ¸
                        </button>
<button class="btn btn-update" id="update-btn" style="display: none;">
<i class="fas fa-sync"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                        </button>
<button class="btn btn-danger" id="cancel-btn">
<i class="fas fa-times-circle"></i> Ø¥Ù„ØºØ§Ø¡
                        </button>
<button class="btn btn-warning" id="reset-btn">
<i class="fas fa-redo"></i> ØªØµÙÙŠØ± Ø§Ù„Ø­Ù‚ÙˆÙ„
                        </button>
<button class="btn btn-danger" id="clear-all-btn">
<i class="fas fa-trash"></i> Ù…Ø­Ùˆ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
</div>
</div>
</div>
<!-- Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
<div class="section" id="reports-section">
<div class="header">
<h1><i class="fas fa-database"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©</h1>
<div class="header-actions">
<button class="btn btn-primary" id="export-btn">
<i class="fas fa-file-export"></i> ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
<button class="btn btn-primary" id="print-filtered-btn"><i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…ÙÙ„ØªØ±</button>
<button class="btn btn-primary" id="print-all-btn">
<i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙƒÙ„
                        </button>
<button class="btn btn-pdf" id="pdf-all-btn">
<i class="fas fa-file-pdf"></i> ØªØµØ¯ÙŠØ± Ø§Ù„ÙƒÙ„ PDF
                        </button>
<button class="btn btn-danger" id="clear-storage-btn">
<i class="fas fa-trash"></i> Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
</div>
</div>
<div class="input-section">
<h2 style="margin-bottom: 20px; color: var(--primary);">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h2>
<div class="advanced-filters">
<div class="input-group">
<label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</label>
<input id="filterEmployeeName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù" type="text"/>
</div>
<div class="input-group">
<label>Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
<input id="filterStartDate" type="date"/>
</div>
<div class="input-group">
<label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
<input id="filterEndDate" type="date"/>
</div>
<div class="input-group">
<label>Ø§Ù„Ø¹Ù…Ù„Ø©</label>
<select id="filterCurrency">
<option value="">Ø§Ù„ÙƒÙ„</option>
<option value="YER">Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ</option>
<option value="SAR">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</option>
<option value="USD">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ</option>
</select>
</div>
<div class="input-group">
<label>Ø§Ù„Ø¨ÙŠØ§Ù†</label>
<input id="filterDescription" placeholder="Ù…Ø«Ù„Ø§Ù‹ Ù†Ù‚Ø¯" type="text"/>
</div>
<div class="input-group">
<label>Ø§Ù„Ù…Ø¨Ù„Øº Ø£ÙƒØ¨Ø± Ù…Ù†</label>
<input id="filterAmountMin" type="number"/>
</div>
<div class="input-group">
<label>Ø§Ù„Ù…Ø¨Ù„Øº Ø£ØµØºØ± Ù…Ù†</label>
<input id="filterAmountMax" type="number"/>
</div>
</div>
<div class="filter-actions">
<button class="btn btn-primary" onclick="applyAdvancedFilters()">
<i class="fas fa-filter"></i> ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±
                        </button>
<button class="btn btn-warning" onclick="resetFilters()">
<i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                        </button>
</div>
<table class="movements-table" id="saved-movements-table">
<thead>
<tr>
<th>Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„</th>
<th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th>
<th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
<th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
<th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù…Ù†Ù‡</th>
<th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„ÙŠÙ…Ù†ÙŠ</th>
<!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª -->
<th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª</th>
<th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
<th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
</tr>
</thead>
<tbody>
<!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
</tbody>
</table>
<!-- Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ -->
<div class="backup-section">
<h3><i class="fas fa-database"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h3>
<div class="backup-actions">
<button class="btn btn-backup" id="create-backup-btn">
<i class="fas fa-save"></i> Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                            </button>
<div class="file-input-wrapper">
<button class="file-input-btn">
<i class="fas fa-upload"></i> Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                                </button>
<input accept=".json" id="restore-backup-input" type="file"/>
</div>
</div>
</div>
</div>
</div>
<!-- Ù‚Ø³Ù… Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø±Ø³ÙˆÙ…ÙŠØ© -->
<div class="section" id="analytics-section">
<div class="header">
<h1><i class="fas fa-chart-pie"></i> Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø±Ø³ÙˆÙ…ÙŠØ©</h1>
<div class="header-actions">
<button class="btn btn-primary" id="print-charts-btn">
<i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
                        </button>
<button class="btn btn-pdf" id="export-charts-btn">
<i class="fas fa-file-pdf"></i> ØªØµØ¯ÙŠØ± PDF
                        </button>
<button class="btn btn-warning" id="refresh-charts-btn">
<i class="fas fa-sync"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³ÙˆÙ…
                        </button>
</div>
</div>
<div class="input-section">
<h2 style="margin-bottom: 20px; color: var(--primary);">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h2>
<div class="analytics-summary">
<div class="analytics-card">
<h3>Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø£ÙƒØ«Ø± Ø­Ø±ÙƒØ©</h3>
<div class="analytics-value" id="top-employee">Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯</div>
<p>Ø£Ø¹Ù„Ù‰ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø­Ø±ÙƒØ§Øª</p>
</div>
<div class="analytics-card">
<h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„ÙƒÙ„ÙŠØ©</h3>
<div class="analytics-value" id="total-movements">12,450 Ø±ÙŠØ§Ù„</div>
<p>Ù…Ø¬Ù…ÙˆØ¹ ÙƒÙ„ Ø§Ù„Ø­Ø±ÙƒØ§Øª</p>
</div>
<div class="analytics-card">
<h3>Ø§Ù„Ø¨ÙŠØ§Ù† Ø§Ù„Ø£ÙƒØ«Ø± ØªÙƒØ±Ø§Ø±Ù‹Ø§</h3>
<div class="analytics-value" id="top-description">Ù…ØµØ±ÙˆÙØ§Øª Ù…ÙƒØªØ¨ÙŠØ©</div>
<p>Ø§Ù„Ø¨ÙŠØ§Ù† Ø§Ù„Ø£ÙƒØ«Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‹Ø§</p>
</div>
</div>
<div class="charts-grid">
<div class="chart-container">
<h3 class="chart-title">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø©</h3>
<canvas id="currency-chart"></canvas>
</div>
<div class="chart-container">
<h3 class="chart-title">Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„Ù…Ø·Ù„ÙˆØ¨</h3>
<canvas id="comparison-chart"></canvas>
</div>
<div class="chart-container">
<h3 class="chart-title">Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3>
<canvas id="employee-chart"></canvas>
</div>
<div class="chart-container">
<h3 class="chart-title">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± ØªÙƒØ±Ø§Ø±Ù‹Ø§</h3>
<canvas id="description-chart"></canvas>
</div>
</div>
</div>
</div>
<!-- Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© -->
<div class="section" id="detailed-section">
<div class="header">
<h1><i class="fas fa-file-alt"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©</h1>
<div class="header-actions">
<button class="btn btn-primary" id="print-detailed-btn">
<i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø©
                        </button>
<button class="btn btn-pdf" id="pdf-detailed-btn">
<i class="fas fa-file-pdf"></i> ØªØµØ¯ÙŠØ± PDF
                        </button>
<button class="btn btn-warning" id="reset-detailed-btn">
<i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ„ØªØ±
                        </button>
</div>
</div>
<div class="input-section">
<div class="filter-header">
<h3>Ø£Ø¯ÙˆØ§Øª Ø§Ù„ÙÙ„ØªØ±Ø©:</h3>
<div>
<span class="filter-icon" data-filter="employee">
<i class="fas fa-user"></i> Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù
                            </span>
<span class="filter-icon" data-filter="date">
<i class="fas fa-calendar"></i> Ø§Ù„ØªØ§Ø±ÙŠØ®
                            </span>
<span class="filter-icon" data-filter="amount">
<i class="fas fa-money-bill"></i> Ø§Ù„Ù…Ø¨Ù„Øº
                            </span>
<span class="filter-icon" data-filter="currency">
<i class="fas fa-coins"></i> Ø§Ù„Ø¹Ù…Ù„Ø©
                            </span>
<span class="filter-icon" data-filter="description">
<i class="fas fa-comment"></i> Ø§Ù„Ø¨ÙŠØ§Ù†
                            </span>
<span class="filter-icon" data-filter="exchange">
<i class="fas fa-exchange-alt"></i> Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù
                            </span>
<span class="filter-icon" data-filter="total">
<i class="fas fa-calculator"></i> Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                            </span>
</div>
</div>
<div id="filter-controls">
<!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ÙÙ„ØªØ±Ø© Ù‡Ù†Ø§ -->
</div>
<h2 style="margin: 20px 0; color: var(--primary);">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©</h2>
<div style="margin:10px 0;">
<label style="display:block;font-weight:600;margin-bottom:6px;">ÙÙ„ØªØ±Ø© Ø¨Ø§Ù„Ù†ÙˆØ¹ <i class="fas fa-tags"></i></label>
<input id="filterTypeDetailed" placeholder="Ø§ÙƒØªØ¨ Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ù†ÙˆØ¹ (Ù…Ø«Ù„Ø§Ù‹: Ù…ÙˆØ¸ÙÙŠÙ†ØŒ Ø­ÙˆØ§Ù„Ø§Øª...)" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;" type="text"/>
</div>
<table class="movements-table" id="detailed-reports-table">
<thead>
<tr>
<th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th>
<th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø±ÙƒÙ‡</th>
<th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
<th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
<th>Ø§Ù„Ø¹Ù…Ù„Ù‡</th>
<th>Ø§Ù„Ø¨ÙŠØ§Ù† Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ</th>
<th>Ø§Ù„Ù†ÙˆØ¹</th>
<th>Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù</th>
<th>Ø§Ù„Ø§Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„ÙŠÙ…Ù†ÙŠ</th>
</tr>
</thead>
<tbody>
<!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
</tbody>
</table>
<div class="filtered-total" id="filtered-total-container">
                        Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…ÙÙ„ØªØ±Ø©: <span id="filtered-total">0.00</span> Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ
                    </div>
</div>
</div>
<!-- Ù‚Ø³Ù… Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
<div class="section" id="dashboard-section">
<div class="header">
<h1><i class="fas fa-tachometer-alt"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
<div class="header-actions">
<button class="btn btn-warning" id="update-rates-btn">
<i class="fas fa-sync"></i> ØªØ­Ø¯ÙŠØ« Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØµØ±Ù
                        </button>
</div>
</div>
<div class="input-section">
<div id="dashboard-content">
<!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
</div>
</div>
</div>
<!-- Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
<div class="section" id="users-section">
<div class="header">
<h1><i class="fas fa-users-cog"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h1>
<div class="header-actions">
<button class="btn btn-primary" id="add-user-btn">
<i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
                        </button>
</div>
</div>
<div class="input-section">
<div id="user-form-container" style="display: none;">
<div class="user-form">
<h3><i class="fas fa-user-edit"></i> <span id="user-form-title">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</span></h3>
<div class="user-form-row">
<div class="user-form-group">
<label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
<input id="user-username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" type="text"/>
</div>
<div class="user-form-group">
<label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
<input id="user-fullname" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" type="text"/>
</div>
</div>
<div class="user-form-row">
<div class="user-form-group">
<label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
<div class="password-container">
<input id="user-password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" type="password"/>
<div class="password-toggler" id="password-toggler">
<i class="fas fa-eye"></i>
</div>
</div>
</div>
<div class="user-form-group">
<label>ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
<input id="user-confirm-password" placeholder="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" type="password"/>
</div>
</div>
<div class="user-form-row">
<div class="user-form-group">
<label>Ø§Ù„Ø¯ÙˆØ±</label>
<select id="user-role">
<option value="admin">Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</option>
<option value="accountant">Ù…Ø­Ø§Ø³Ø¨</option>
</select>
</div>
</div>
<div class="user-form-row">
<button class="btn btn-success" id="save-user-btn">
<i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                                </button>
<button class="btn btn-danger" id="cancel-user-btn">
<i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                                </button>
</div>
</div>
</div>
<table class="user-table">
<thead>
<tr>
<th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
<th>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</th>
<th>Ø§Ù„Ø¯ÙˆØ±</th>
<th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</th>
<th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
</tr>
</thead>
<tbody id="users-table-body">
<!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
</tbody>
</table>
</div>
</div>
<div class="content-section" id="manual-backup-section" style="display:none;">
<h2>ğŸ›¡ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h2>
<p>Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙŠØ¯ÙˆÙŠØ© Ø£Ùˆ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©.</p>
<button class="btn btn-success" onclick="manualBackup()">ğŸ’¾ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
<input id="manualRestoreInput" onchange="manualRestore(event)" style="display:none" type="file"/>
<button class="btn btn-info" onclick="document.getElementById('manualRestoreInput').click()">ğŸ“‚ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
</div>
</div>
</div>
<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
<div class="print-window" id="print-window">
<div class="print-close" id="print-close">
<i class="fas fa-times"></i>
</div>
<div class="print-content" id="print-content">
<!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
</div>
</div>
<!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
<div class="loading-overlay" id="loading-overlay">
<div class="loading-spinner"></div>
</div>
<script>
        // ======== Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ========
        function initUsers() {
            if (!localStorage.getItem("users")) {
                const initialUsers = [
                    { id: 1, username: "admin", password: "admin123", role: "admin", fullName: "Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…", createdAt: new Date().toISOString() },
                    { id: 2, username: "accountant", password: "accountant123", role: "accountant", fullName: "Ù…Ø­Ø§Ø³Ø¨", createdAt: new Date().toISOString() }
                ];
                localStorage.setItem("users", JSON.stringify(initialUsers));
            }
        }
        
        function login(username, password) {
            const users = JSON.parse(localStorage.getItem("users") || '[]');
            const user = users.find(u => u.username === username && u.password === password);
            if (user) {
                localStorage.setItem("currentUser", JSON.stringify(user));
                return true;
            }
            return false;
        }
        
        function logout() {
            localStorage.removeItem("currentUser");
            showLoginModal();
            document.getElementById('user-info').style.display = 'none';
        }
        
        function checkPermission(requiredRole) {
            const user = JSON.parse(localStorage.getItem("currentUser"));
            return user && (user.role === "admin" || user.role === requiredRole);
        }
        
        function showLoginModal() {
            document.getElementById('login-modal').style.display = 'flex';
        }
        
        function hideLoginModal() {
            document.getElementById('login-modal').style.display = 'none';
        }
        
        function updateUserInfo() {
            const user = JSON.parse(localStorage.getItem("currentUser"));
            if (user) {
                document.getElementById('user-info').style.display = 'block';
                document.getElementById('current-user').textContent = user.username;
                document.getElementById('current-role').textContent = 
                    user.role === "admin" ? "Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…" : "Ù…Ø­Ø§Ø³Ø¨";
                    
                // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                const usersSectionItem = document.getElementById('users-section-item');
                if (user.role === "admin") {
                    usersSectionItem.style.display = "flex";
                } else {
                    usersSectionItem.style.display = "none";
                    document.getElementById('users-section').style.display = "none";
                }
            }
        }
        
        // ======== Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ========
        function showNotification(message, type = "success") {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check' : 'exclamation'}-circle"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // ======== Ø±Ø¨Ø· Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØµØ±Ù Ø¨API ========
        async function updateExchangeRates() {
            try {
                // ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹: Ø§Ø³ØªØ¨Ø¯Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨API Ø­Ù‚ÙŠÙ‚ÙŠ
                // const response = await fetch("https://api.exchangerate-api.com/v4/latest/USD");
                // Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©:
                const mockResponse = {
                    "rates": {
                        "YER": 250,
                        "SAR": 3.75,
                        "USD": 1
                    }
                };
                
                // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©: const data = await response.json();
                const data = mockResponse;
                
                localStorage.setItem("exchangeRates", JSON.stringify({
                    USD: data.rates.YER,
                    SAR: data.rates.YER / data.rates.SAR
                }));
                
                showNotification("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØµØ±Ù Ø¨Ù†Ø¬Ø§Ø­", "success");
                return true;
            } catch (error) {
                console.error("ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØµØ±Ù:", error);
                showNotification("ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØµØ±Ù", "error");
                return false;
            }
        }
        
        function getExchangeRate(currency) {
            const rates = JSON.parse(localStorage.getItem("exchangeRates")) || {
                USD: 553,
                SAR: 140,
                YER: 1
            };
            return rates[currency];
        }
        
        // ======== Ø¥Ø±ÙØ§Ù‚ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª ========
        function saveAttachment(file) {
            return new Promise((resolve, reject) => {
                if (!file) resolve(null);
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const attachments = JSON.parse(localStorage.getItem("attachments")) || {};
                    const id = Date.now().toString();
                    attachments[id] = {
                        name: file.name,
                        type: file.type,
                        data: e.target.result.split(",")[1]
                    };
                    localStorage.setItem("attachments", JSON.stringify(attachments));
                    resolve(id);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        function showAttachment(id) {
            const attachments = JSON.parse(localStorage.getItem("attachments")) || {};
            const attachment = attachments[id];
            if (attachment) {
                const url = `data:${attachment.type};base64,${attachment.data}`;
                window.open(url, "_blank");
            }
        }
        
        // ======== Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ========
        function createDashboard() {
            const savedMovements = JSON.parse(localStorage.getItem("movements")) || [];
            
            // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø£Ø³Ø§Ø³ÙŠØ©
            const totalAmount = savedMovements.reduce((sum, m) => sum + m.totalAmount, 0);
            const employees = [...new Set(savedMovements.map(m => m.employeeName))];
            const recentMovements = savedMovements.slice(-5).reverse();
            
            return `
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h3><i class="fas fa-coins"></i> Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø±ÙƒØ§Øª</h3>
                        <div class="dashboard-value">${totalAmount.toLocaleString('ar')} Ø±ÙŠØ§Ù„</div>
                    </div>
                    
                    <div class="dashboard-card">
                        <h3><i class="fas fa-users"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3>
                        <div class="dashboard-value">${employees.length}</div>
                    </div>
                    
                    <div class="dashboard-card">
                        <h3><i class="fas fa-exchange-alt"></i> Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØµØ±Ù Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
                        <div class="exchange-update">
                            <p>Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±: ${getExchangeRate('USD')} Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ</p>
                            <p>Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ: ${getExchangeRate('SAR')} Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ</p>
                            <p style="margin-top: 10px; font-style: italic;">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${new Date().toLocaleDateString('ar-YE')}</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card" style="grid-column: span 2;">
                        <h3><i class="fas fa-history"></i> Ø¢Ø®Ø± Ø§Ù„Ø­Ø±ÙƒØ§Øª</h3>
                        <ul class="recent-movements">
                            ${recentMovements.length > 0 ? recentMovements.map(m => `
                                <li>
                                    <span>${m.employeeName} (${m.date})</span>
                                    <span>${m.totalAmount.toLocaleString('ar')} Ø±ÙŠØ§Ù„</span>
                                </li>
                            `).join('') : '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª Ù…Ø³Ø¬Ù„Ø©</p>'}
                        </ul>
                    </div>
                    
                    <div class="dashboard-card">
                        <h3><i class="fas fa-chart-bar"></i> ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø©</h3>
                        <div class="mini-chart">
                            <canvas id="dashboard-currency-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <h3><i class="fas fa-chart-line"></i> Ø­Ø±ÙƒØ© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø®Ù„Ø§Ù„ Ø§Ù„Ø´Ù‡Ø±</h3>
                        <div class="mini-chart">
                            <canvas id="dashboard-activity-chart"></canvas>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ======== ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ ========
        function updateSidebar() {
            const user = JSON.parse(localStorage.getItem("currentUser"));
            if (user) {
                updateUserInfo();
            }
        }
        
        // ======== ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¹Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª ========
        function addAttachmentField(row) {
            const attachmentCell = document.createElement('td');
            attachmentCell.className = 'attachment-cell';
            attachmentCell.innerHTML = `
                <button class="attachment-btn">
                    <i class="fas fa-paperclip"></i>
                </button>
                <input type="file" class="attachment-input" accept="image/*,.pdf" style="display:none">
                <img class="attachment-preview" style="display:none">
            `;
            row.insertBefore(attachmentCell, row.cells[6]);
            
            const attachmentBtn = attachmentCell.querySelector('.attachment-btn');
            const attachmentInput = attachmentCell.querySelector('.attachment-input');
            const attachmentPreview = attachmentCell.querySelector('.attachment-preview');
            
            attachmentBtn.addEventListener('click', () => attachmentInput.click());
            
            attachmentInput.addEventListener('change', function() {
                if (this.files.length > 0) {
                    const file = this.files[0];
                    if (file.size > 2 * 1024 * 1024) {
                        showNotification("Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† 2MB", "error");
                        return;
                    }
                    
                    // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            attachmentPreview.src = e.target.result;
                            attachmentPreview.style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    } else {
                        attachmentPreview.style.display = 'none';
                    }
                }
            });
        }
        
        // ======== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ========
        function loadUsers() {
            const users = JSON.parse(localStorage.getItem("users") || []);
            const tableBody = document.getElementById('users-table-body');
            tableBody.innerHTML = '';
            
            users.forEach(user => {
                const row = document.createElement('tr');
                const createdAt = new Date(user.createdAt).toLocaleDateString('ar-YE');
                
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.fullName}</td>
                    <td>
                        <span class="role-badge ${user.role === 'admin' ? 'role-admin' : 'role-accountant'}">
                            ${user.role === 'admin' ? 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…' : 'Ù…Ø­Ø§Ø³Ø¨'}
                        </span>
                    </td>
                    <td>${createdAt}</td>
                    <td class="user-actions">
                        <button class="action-btn edit" data-id="${user.id}"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete" data-id="${user.id}"><i class="fas fa-trash"></i></button>
                        <button class="action-btn change-password" data-id="${user.id}"><i class="fas fa-key"></i></button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('#users-table-body .edit').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    editUser(id);
                });
            });
            
            document.querySelectorAll('#users-table-body .delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    deleteUser(id);
                });
            });
            
            document.querySelectorAll('#users-table-body .change-password').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    changePassword(id);
                });
            });
        }
        
        function showUserForm(title = 'Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯') {
            const formContainer = document.getElementById('user-form-container');
            formContainer.style.display = 'block';
            document.getElementById('user-form-title').textContent = title;
            document.getElementById('save-user-btn').setAttribute('data-mode', 'add');
            document.getElementById('save-user-btn').setAttribute('data-id', '');
            
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('user-username').value = '';
            document.getElementById('user-fullname').value = '';
            document.getElementById('user-password').value = '';
            document.getElementById('user-confirm-password').value = '';
            document.getElementById('user-role').value = 'accountant';
        }
        
        function editUser(id) {
            const users = JSON.parse(localStorage.getItem("users") || []);
            const user = users.find(u => u.id == id);
            
            if (!user) {
                showNotification("Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯", "error");
                return;
            }
            
            const formContainer = document.getElementById('user-form-container');
            formContainer.style.display = 'block';
            document.getElementById('user-form-title').textContent = `ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${user.username}`;
            document.getElementById('save-user-btn').setAttribute('data-mode', 'edit');
            document.getElementById('save-user-btn').setAttribute('data-id', id);
            
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('user-username').value = user.username;
            document.getElementById('user-fullname').value = user.fullName;
            document.getElementById('user-role').value = user.role;
            
            // Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚ÙˆÙ„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
            document.getElementById('user-password').value = '';
            document.getElementById('user-confirm-password').value = '';
        }
        
        function changePassword(id) {
            const users = JSON.parse(localStorage.getItem("users") || []);
            const user = users.find(u => u.id == id);
            
            if (!user) {
                showNotification("Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯", "error");
                return;
            }
            
            const formContainer = document.getElementById('user-form-container');
            formContainer.style.display = 'block';
            document.getElementById('user-form-title').textContent = `ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: ${user.username}`;
            document.getElementById('save-user-btn').setAttribute('data-mode', 'password');
            document.getElementById('save-user-btn').setAttribute('data-id', id);
            
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('user-username').value = user.username;
            document.getElementById('user-fullname').value = user.fullName;
            document.getElementById('user-role').value = user.role;
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø­Ù‚ÙˆÙ„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙÙ‚Ø·
            document.getElementById('user-password').value = '';
            document.getElementById('user-confirm-password').value = '';
        }
        
        function saveUser() {
            const mode = document.getElementById('save-user-btn').getAttribute('data-mode');
            const id = document.getElementById('save-user-btn').getAttribute('data-id');
            const username = document.getElementById('user-username').value.trim();
            const fullName = document.getElementById('user-fullname').value.trim();
            const password = document.getElementById('user-password').value;
            const confirmPassword = document.getElementById('user-confirm-password').value;
            const role = document.getElementById('user-role').value;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            if (!username) {
                showNotification("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…", "error");
                return;
            }
            
            if (!fullName) {
                showNotification("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„", "error");
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
            if (mode === 'add' || mode === 'password') {
                if (!password) {
                    showNotification("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±", "error");
                    return;
                }
                
                if (password.length < 6) {
                    showNotification("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„", "error");
                    return;
                }
                
                if (password !== confirmPassword) {
                    showNotification("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©", "error");
                    return;
                }
            }
            
            let users = JSON.parse(localStorage.getItem("users") || []);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø± Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            if (mode === 'add') {
                const userExists = users.some(u => u.username === username);
                if (userExists) {
                    showNotification("Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹", "error");
                    return;
                }
            }
            
            if (mode === 'add') {
                // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
                const newUser = {
                    id: Date.now(),
                    username,
                    password,
                    role,
                    fullName,
                    createdAt: new Date().toISOString()
                };
                
                users.push(newUser);
                localStorage.setItem("users", JSON.stringify(users));
                showNotification("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­", "success");
                
            } else if (mode === 'edit') {
                // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const userIndex = users.findIndex(u => u.id == id);
                if (userIndex !== -1) {
                    users[userIndex].username = username;
                    users[userIndex].fullName = fullName;
                    users[userIndex].role = role;
                    
                    localStorage.setItem("users", JSON.stringify(users));
                    showNotification("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­", "success");
                }
                
            } else if (mode === 'password') {
                // ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                const userIndex = users.findIndex(u => u.id == id);
                if (userIndex !== -1) {
                    users[userIndex].password = password;
                    localStorage.setItem("users", JSON.stringify(users));
                    showNotification("ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­", "success");
                }
            }
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            loadUsers();
            document.getElementById('user-form-container').style.display = 'none';
        }
        
        function deleteUser(id) {
            const users = JSON.parse(localStorage.getItem("users") || []);
            const user = users.find(u => u.id == id);
            
            if (!user) {
                showNotification("Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯", "error");
                return;
            }
            
            // Ù…Ù†Ø¹ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
            const currentUser = JSON.parse(localStorage.getItem("currentUser"));
            if (currentUser && currentUser.id == id) {
                showNotification("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ", "error");
                return;
            }
            
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… "${user.username}"ØŸ`)) {
                const updatedUsers = users.filter(u => u.id != id);
                localStorage.setItem("users", JSON.stringify(updatedUsers));
                showNotification("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­", "success");
                loadUsers();
            }
        }
        
        // ======== Ø¥ØµÙ„Ø§Ø­ Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙ„ØªØ±Ø© ========
        function applyAdvancedFilters() {
            const employeeName = document.getElementById('filterEmployeeName').value.toLowerCase();
            const startDate = document.getElementById('filterStartDate').value;
            const endDate = document.getElementById('filterEndDate').value;
            const currency = document.getElementById('filterCurrency').value;
            const description = document.getElementById('filterDescription').value.toLowerCase();
            const amountMin = parseFloat(document.getElementById('filterAmountMin').value) || 0;
            const amountMax = parseFloat(document.getElementById('filterAmountMax').value) || Number.MAX_SAFE_INTEGER;
            
            const savedMovements = JSON.parse(localStorage.getItem("movements")) || [];
            const filteredMovements = savedMovements.filter(movement => {
                // ÙÙ„ØªØ±Ø© Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù
                if (employeeName && !movement.employeeName.toLowerCase().includes(employeeName)) {
                    return false;
                }
                
                // ÙÙ„ØªØ±Ø© Ø§Ù„ØªØ§Ø±ÙŠØ®
                if (startDate && movement.date < startDate) return false;
                if (endDate && movement.date > endDate) return false;
                
                // ÙÙ„ØªØ±Ø© Ø§Ù„Ø¹Ù…Ù„Ø©
                if (currency) {
                    const hasCurrency = movement.movements.some(item => item.currency === currency);
                    if (!hasCurrency) return false;
                }
                
                // ÙÙ„ØªØ±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†
                if (description) {
                    const hasDescription = movement.movements.some(item => 
                        item.description.toLowerCase().includes(description));
                    if (!hasDescription) return false;
                }
                
                // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ø¨Ù„Øº
                if (amountMin > 0 || amountMax < Number.MAX_SAFE_INTEGER) {
                    const inAmountRange = movement.movements.some(item => 
                        item.amount >= amountMin && item.amount <= amountMax);
                    if (!inAmountRange) return false;
                }
                
                return true;
            });
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø©
            loadSavedMovements(filteredMovements);
        }
        
        function resetFilters() {
            document.getElementById('filterEmployeeName').value = '';
            document.getElementById('filterStartDate').value = '';
            document.getElementById('filterEndDate').value = '';
            document.getElementById('filterCurrency').value = '';
            document.getElementById('filterDescription').value = '';
            document.getElementById('filterAmountMin').value = '';
            document.getElementById('filterAmountMax').value = '';
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            loadSavedMovements();
        }
        
        // ======== Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ========
        document.addEventListener('DOMContentLoaded', function() {
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            initUsers();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            if (!localStorage.getItem("currentUser")) {
                showLoginModal();
            } else {
                hideLoginModal();
                updateSidebar();
            }
            
            // Ø­Ø¯Ø« ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            document.getElementById('login-btn').addEventListener('click', function() {
                const username = document.getElementById('login-username').value;
                const password = document.getElementById('login-password').value;
                
                if (login(username, password)) {
                    hideLoginModal();
                    updateSidebar();
                    showNotification("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­", "success");
                } else {
                    showNotification("Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©", "error");
                }
            });
            
            // Ø­Ø¯Ø« ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            document.getElementById('logout-btn').addEventListener('click', logout);
            
            // ØªØ­Ø¯ÙŠØ« Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØµØ±Ù
            if (!localStorage.getItem("exchangeRates")) {
                updateExchangeRates();
            }
            
            // ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            document.querySelector('[data-section="dashboard"]').addEventListener('click', function() {
                document.getElementById('dashboard-content').innerHTML = createDashboard();
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                generateDashboardCharts();
            });
            
            // Ø­Ø¯Ø« ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
            document.getElementById('update-rates-btn').addEventListener('click', function() {
                showNotification("Ø¬Ø§Ø±Ù ØªØ­Ø¯ÙŠØ« Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØµØ±Ù...", "info");
                updateExchangeRates();
            });
            
            // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            document.querySelector('[data-section="users"]').addEventListener('click', function() {
                loadUsers();
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
            document.getElementById('add-user-btn').addEventListener('click', function() {
                showUserForm();
            });
            
            // Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            document.getElementById('save-user-btn').addEventListener('click', saveUser);
            
            // Ø¥Ù„ØºØ§Ø¡ Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            document.getElementById('cancel-user-btn').addEventListener('click', function() {
                document.getElementById('user-form-container').style.display = 'none';
            });
            
            // ØªØ¨Ø¯ÙŠÙ„ Ø±Ø¤ÙŠØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
            document.getElementById('password-toggler').addEventListener('click', function() {
                const passwordInput = document.getElementById('user-password');
                const icon = this.querySelector('i');
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    icon.className = 'fas fa-eye-slash';
                } else {
                    passwordInput.type = 'password';
                    icon.className = 'fas fa-eye';
                }
            });
            
            // ... Ø¨Ù‚ÙŠØ© Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© ...
            initApp();
        });
        
        // ======== Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© ========
        // Ù…ØªØºÙŠØ± Ù„ØªØ®Ø²ÙŠÙ† Ù…Ø¹Ø±Ù Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
        let currentEditId = null;
        let lastDeletedMovement = null;

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        function initApp() {
            // ØªØ¹ÙŠÙŠÙ† ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ
            document.getElementById('movement-date').valueAsDate = new Date();
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ Ù…Ù† localStorage
            const nextId = localStorage.getItem('nextId') || 1;
            document.getElementById('serial-number').textContent = nextId;
            
            // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„
            document.querySelectorAll('#movements-body tr').forEach(row => {
                addRowEvents(row);
            });
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
            document.querySelector('[data-section="reports"]').addEventListener('click', function() {
                loadSavedMovements();
            });
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø³Ù…
            document.querySelector('[data-section="detailed"]').addEventListener('click', function() {
                loadDetailedReports();
                // Ø±Ø¨Ø· Ø²Ø± Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø© Ù‡Ù†Ø§ Ø£ÙŠØ¶Ù‹Ø§
                document.getElementById('print-detailed-btn').addEventListener('click', printDetailedReports);
            });
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø³Ù…
            document.querySelector('[data-section="analytics"]').addEventListener('click', function() {
                generateCharts();
                updateAnalyticsSummary();
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„ÙÙ„ØªØ±Ø©
            document.querySelectorAll('.filter-icon').forEach(icon => {
                icon.addEventListener('click', function() {
                    const filterType = this.getAttribute('data-filter');
                    addFilterControl(filterType);
                });
            });
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ„ØªØ±
            document.getElementById('reset-detailed-btn').addEventListener('click', resetDetailedFilter);
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
            if (!localStorage.getItem('movements') || localStorage.getItem('movements') === '[]') {
                localStorage.setItem('movements', JSON.stringify(sampleData));
                localStorage.setItem('nextId', sampleData.length + 1);
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
            document.getElementById('create-backup-btn').addEventListener('click', createBackup);
            document.getElementById('restore-backup-input').addEventListener('change', restoreBackup);
            
            // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            document.getElementById('print-all-btn').addEventListener('click', printAllMovements);
            document.getElementById('clear-all-btn').addEventListener('click', clearAllMovements);
            document.getElementById('clear-storage-btn').addEventListener('click', clearAllMovements);
            
            // Ø±Ø¨Ø· Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ØªØ­Ø¯ÙŠØ«
            document.getElementById('update-btn').addEventListener('click', updateMovement);
            document.getElementById('cancel-btn').addEventListener('click', resetForm);
            document.getElementById('reset-btn').addEventListener('click', resetForm);
            
            // Ø±Ø¨Ø· Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£ØµÙ„ÙŠØ©
            document.getElementById('print-btn').addEventListener('click', printInputData);
            document.getElementById('save-btn').addEventListener('click', function() {
                saveMovement();
                alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ø±ÙƒØ© Ø¨Ù†Ø¬Ø§Ø­');
            });
            document.getElementById('confirm-save-btn').addEventListener('click', function() {
                const movement = saveMovement();
                alert(`âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ø±ÙƒØ© Ø±Ù‚Ù… ${movement.id} Ø¨Ù†Ø¬Ø§Ø­`);
                resetForm();
            });
            document.getElementById('add-row-btn').addEventListener('click', addNewRow);
            
            // Ø±Ø¨Ø· Ø²Ø± Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø©
            document.getElementById('print-detailed-btn').addEventListener('click', printDetailedReports);
            
            // Ø¥ØµÙ„Ø§Ø­: Ø±Ø¨Ø· Ø²Ø± Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…ÙÙ„ØªØ±
            document.getElementById('print-filtered-btn').addEventListener('click', printFilteredMovements);
            
            // Ø¥ØµÙ„Ø§Ø­: Ø±Ø¨Ø· Ø²Ø± ØªØµØ¯ÙŠØ± Ø§Ù„ÙƒÙ„ PDF
            document.getElementById('pdf-all-btn').addEventListener('click', exportAllToPDF);
        }
        
        // ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
        document.querySelectorAll('.dept-item').forEach(item => {
            item.addEventListener('click', function() {
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
                document.querySelectorAll('.dept-item').forEach(i => {
                    i.classList.remove('active');
                });
                
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ø´Ø§Ø· Ù„Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯
                this.classList.add('active');
                
                // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø³Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
                const sectionId = this.getAttribute('data-section') + '-section';
                document.getElementById(sectionId).classList.add('active');
            });
        });
        
        // Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø­Ø±ÙƒØ§Øª
        function addNewRow() {
            const tableBody = document.getElementById('movements-body');
            const rowCount = tableBody.querySelectorAll('tr').length;
            
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>${rowCount + 1}</td>
                <td><input type="number" class="amount-input" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" step="0.01"></td>
                <td>
                    <select class="currency-select">
                        <option value="YER">Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ</option>
                        <option value="SAR">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</option>
                        <option value="USD">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ</option>
                    </select>
                </td>
                <td><input type="text" class="description-input" placeholder="Ø§Ù„Ø¨ÙŠØ§Ù†"></td>
                <td>
                    <select class="type-select">
                     <option value="Ù…ÙˆØ¸ÙÙŠÙ†">Ù…ÙˆØ¸ÙÙŠÙ†</option>
        <option value="Ù…Ø¹Ù„Ù‚Ø§Øª">Ù…Ø¹Ù„Ù‚Ø§Øª</option>
        <option value="Ø³Ø¯Ø§Ø¯Ù…ÙˆØ±Ø¯ÙŠÙ†">Ø³Ø¯Ø§Ø¯Ù…ÙˆØ±Ø¯ÙŠÙ†</option>
        <option value="Ù…ØµØ±ÙˆÙØ§Øª">Ù…ØµØ±ÙˆÙØ§Øª</option>
        <option value="Ø§Ù„Ù…Ø¯ÙŠØ±">Ø§Ù„Ù…Ø¯ÙŠØ±</option>
        <option value="ÙÙˆØ§ØªÙŠØ± Ù…Ø´ØªØ±ÙŠØ§Øª">ÙÙˆØ§ØªÙŠØ± Ù…Ø´ØªØ±ÙŠØ§Øª</option>
        <option value="Ù†Ù‚Ø¯ÙŠÙ‡">Ù†Ù‚Ø¯ÙŠÙ‡</option>
        <option value="Ø§Ø®Ø±Ù‰">Ø§Ø®Ø±Ù‰</option>
        <option value="Ù…Ø³Ø³Ù„Ù… Ù…Ø¹Ù„Ù‚Ø§Øª Ø³Ø§Ø¨Ù‚Ù‡">Ù…Ø³Ø³Ù„Ù… Ù…Ø¹Ù„Ù‚Ø§Øª Ø³Ø§Ø¨Ù‚Ù‡</option>
                    </select>
                </td>
                <td><input type="number" class="exchange-input" value="1" step="0.01" disabled></td>
                <td class="total-cell">0.00</td>
                <td class="attachment-cell">
                    <button class="attachment-btn">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <input type="file" class="attachment-input" accept="image/*,.pdf">
                    <img class="attachment-preview" style="display:none">
                </td>
                <td class="action-buttons">
                    <button class="action-btn delete"><i class="fas fa-trash"></i></button>
                </td>
            `;
            
            tableBody.appendChild(newRow);
            
            // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„Ù„ØµÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            addRowEvents(newRow);
            
            // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª
            const attachmentBtn = newRow.querySelector('.attachment-btn');
            const attachmentInput = newRow.querySelector('.attachment-input');
            const attachmentPreview = newRow.querySelector('.attachment-preview');
            
            attachmentBtn.addEventListener('click', () => attachmentInput.click());
            
            attachmentInput.addEventListener('change', function() {
                if (this.files.length > 0) {
                    const file = this.files[0];
                    if (file.size > 2 * 1024 * 1024) {
                        showNotification("Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† 2MB", "error");
                        return;
                    }
                    
                    // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            attachmentPreview.src = e.target.result;
                            attachmentPreview.style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    } else {
                        attachmentPreview.style.display = 'none';
                    }
                }
            });
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø©
        function addRowEvents(row) {
            const currencySelect = row.querySelector('.currency-select');
            const exchangeInput = row.querySelector('.exchange-input');
            const amountInput = row.querySelector('.amount-input');
            
            currencySelect.addEventListener('change', function() {
                if (this.value === 'YER') {
                    exchangeInput.disabled = true;
                    exchangeInput.value = '1';
                } else if (this.value === 'SAR') {
                    exchangeInput.disabled = false;
                    exchangeInput.value = '140';
                } else if (this.value === 'USD') {
                    exchangeInput.disabled = false;
                    exchangeInput.value = '553';
                }
                calculateTotal(row);
                updateSummary();
            });
            
            exchangeInput.addEventListener('input', function() {
                calculateTotal(row);
                updateSummary();
            });
            
            amountInput.addEventListener('input', function() {
                calculateTotal(row);
                updateSummary();
            });
            
            // Ø­Ø¯Ø« Ù„Ø­Ø°Ù Ø§Ù„ØµÙ
            const deleteBtn = row.querySelector('.delete');
            deleteBtn.addEventListener('click', function() {
                row.remove();
                updateRowNumbers();
                updateSummary();
            });
        }
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„ÙƒÙ„ ØµÙ
        function calculateTotal(row) {
            const amountInput = row.querySelector('.amount-input');
            const exchangeInput = row.querySelector('.exchange-input');
            const totalCell = row.querySelector('.total-cell');
            
            const amount = parseFloat(amountInput.value) || 0;
            const exchange = parseFloat(exchangeInput.value) || 1;
            const total = amount * exchange;
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø±Ù‚Ù… Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ (Ù„ÙƒÙ† ÙƒÙ†Øµ)
            totalCell.textContent = total.toFixed(2);
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØµÙÙˆÙ Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù
        function updateRowNumbers() {
            const rows = document.querySelectorAll('#movements-body tr');
            rows.forEach((row, index) => {
                row.querySelector('td:first-child').textContent = index + 1;
            });
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ
        function updateSummary() {
            const totalCells = document.querySelectorAll('.total-cell');
            let totalAmount = 0;
            let suspendedTotal = 0;
            
            totalCells.forEach((cell, index) => {
                const row = cell.closest('tr');
                const typeSelect = row.querySelector('.type-select');
                const typeValue = typeSelect ? typeSelect.value : '';
                
                const value = parseFloat(cell.textContent) || 0;
                totalAmount += value;
                
                // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª
                if (typeValue === 'Ù…Ø³Ø³Ù„Ù… Ù…Ø¹Ù„Ù‚Ø§Øª Ø³Ø§Ø¨Ù‚Ù‡') {
                    suspendedTotal += value;
                }
            });
            
            document.getElementById('total-amount').textContent = totalAmount.toFixed(2) + ' Ø±ÙŠØ§Ù„';
            document.getElementById('suspended-total').textContent = suspendedTotal.toFixed(2) + ' Ø±ÙŠØ§Ù„';
            
            const requiredInput = document.getElementById('required-amount');
            const requiredAmount = parseFloat(requiredInput.value) || 0;
            
            // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ§Ø±Ù‚ Ù…Ø¹ Ø·Ø±Ø­ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª
            const difference = totalAmount - requiredAmount - suspendedTotal;
            
            const differenceElement = document.getElementById('difference-amount');
            differenceElement.textContent = Math.abs(difference).toFixed(2) + ' Ø±ÙŠØ§Ù„';
            
            const statusBox = document.getElementById('status-box');
            
            if (difference === 0) {
                statusBox.className = 'status-box status-match';
                statusBox.innerHTML = '<i class="fas fa-check-circle"></i> Ù…Ø·Ø§Ø¨Ù‚';
                differenceElement.className = 'summary-value difference-amount';
            } else if (difference > 0) {
                statusBox.className = 'status-box status-excess';
                statusBox.innerHTML = '<i class="fas fa-arrow-up"></i> Ø²ÙŠØ§Ø¯Ø©';
                differenceElement.className = 'summary-value difference-amount positive';
            } else {
                statusBox.className = 'status-box status-shortage';
                statusBox.innerHTML = '<i class="fas fa-arrow-down"></i> Ù†Ù‚Øµ';
                differenceElement.className = 'summary-value difference-amount negative';
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø­ÙØ¸ Ø§Ù„Ø­Ø±ÙƒØ©
        async function saveMovement() {
            const employeeName = document.getElementById('employee-name').value;
            const movementDate = document.getElementById('movement-date').value;
            const note = document.getElementById('employee-note').value; // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
            const requiredAmount = parseFloat(document.getElementById('required-amount').value) || 0;
            
            // Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„
            const movements = [];
            const rows = document.querySelectorAll('#movements-body tr');
            let totalAmount = 0;
            let suspendedTotal = 0; // Ø¥Ø¶Ø§ÙØ© Ù…ØªØºÙŠØ± Ù„Ø¬Ù…Ø¹ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª
            
            for (const row of rows) {
                const amount = parseFloat(row.querySelector('.amount-input').value) || 0;
                const currency = row.querySelector('.currency-select').value;
                const description = row.querySelector('.description-input').value;
                const type = row.querySelector('.type-select').value;
                const exchangeRate = parseFloat(row.querySelector('.exchange-input').value) || 1;
                const total = parseFloat(row.querySelector('.total-cell').textContent) || 0;
                
                // Ø­ÙØ¸ Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª
                const attachmentInput = row.querySelector('.attachment-input');
                let attachmentId = null;
                if (attachmentInput.files.length > 0) {
                    const file = attachmentInput.files[0];
                    attachmentId = await saveAttachment(file);
                }
                
                movements.push({
                    amount,
                    currency,
                    description,
                    type,
                    exchangeRate,
                    total,
                    attachmentId
                });
                
                totalAmount += total;
                
                // Ø¬Ù…Ø¹ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª
                if (type === 'Ù…Ø³Ø³Ù„Ù… Ù…Ø¹Ù„Ù‚Ø§Øª Ø³Ø§Ø¨Ù‚Ù‡') {
                    suspendedTotal += total;
                }
            }
            
            // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ§Ø±Ù‚ Ù…Ø¹ Ø·Ø±Ø­ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª
            const difference = totalAmount - requiredAmount - suspendedTotal;
            let status;
            if (difference === 0) {
                status = 'match';
            } else if (difference > 0) {
                status = 'excess';
            } else {
                status = 'shortage';
            }
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ
            const serialNumber = parseInt(document.getElementById('serial-number').textContent);
            
            // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„Ø­Ø±ÙƒØ©
            const movementRecord = {
                id: serialNumber,
                employeeName,
                note, // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø¹ Ø§Ù„Ø­Ø±ÙƒØ©
                date: movementDate,
                movements,
                totalAmount,
                requiredAmount,
                difference: Math.abs(difference),
                status,
                suspendedTotal // ØªØ®Ø²ÙŠÙ† Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª
            };
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ù† localStorage
            let savedMovements = JSON.parse(localStorage.getItem('movements')) || [];
            savedMovements.push(movementRecord);
            
            // Ø­ÙØ¸ Ø§Ù„Ø­Ø±ÙƒØ©
            localStorage.setItem('movements', JSON.stringify(savedMovements));
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ
            const nextId = serialNumber + 1;
            localStorage.setItem('nextId', nextId);
            document.getElementById('serial-number').textContent = nextId;
            
            return movementRecord;
        }
        
        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
        function loadSavedMovements(movementsArray = null) {
            const savedMovements = movementsArray || JSON.parse(localStorage.getItem('movements')) || [];
            const tableBody = document.querySelector('#saved-movements-table tbody');
            tableBody.innerHTML = '';
            
            savedMovements.forEach(movement => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${movement.id}</td>
                    <td>${movement.employeeName}</td>
                    <td>${movement.date}</td>
                    <td>${movement.note || "â€”"}</td> <!-- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
                    <td>${movement.requiredAmount.toFixed(2)}</td>
                    <td>${movement.totalAmount.toFixed(2)}</td>
                    <!-- Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª -->
                    <td>${movement.suspendedTotal ? movement.suspendedTotal.toFixed(2) : '0.00'}</td>
                    <td>
                        ${movement.status === 'match' ? 
                            '<span class="status-match">Ù…Ø·Ø§Ø¨Ù‚</span>' : 
                            movement.status === 'excess' ? 
                            '<span class="status-excess">Ø²ÙŠØ§Ø¯Ø©</span>' : 
                            '<span class="status-shortage">Ù†Ù‚Øµ</span>'}
                    </td>
                    <td>
                        <button class="action-btn print" data-id="${movement.id}"><i class="fas fa-print"></i></button>
                        <button class="action-btn pdf" data-id="${movement.id}"><i class="fas fa-file-pdf"></i></button>
                        <button class="action-btn load" data-id="${movement.id}"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete" data-id="${movement.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø§Ù„Ø­Ø°Ù Ù„Ù„ØµÙÙˆÙ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            document.querySelectorAll('#saved-movements-table .delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    deleteMovement(id);
                });
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù„Ù„ØµÙÙˆÙ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            document.querySelectorAll('#saved-movements-table .print').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    printSavedMovement(id);
                });
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« ØªØµØ¯ÙŠØ± PDF Ù„Ù„ØµÙÙˆÙ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            document.querySelectorAll('#saved-movements-table .pdf').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    exportMovementToPDF(id);
                });
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
            document.querySelectorAll('#saved-movements-table .load').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    loadMovementForEditing(id);
                });
            });
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø­Ø°Ù Ø­Ø±ÙƒØ© Ù…Ø­ÙÙˆØ¸Ø©
        function deleteMovement(id) {
            let savedMovements = JSON.parse(localStorage.getItem('movements')) || [];
            const deleted = savedMovements.find(movement => movement.id == id);
            if (!deleted) {
                alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø±ÙƒØ©.');
                return;
            }
            lastDeletedMovement = deleted;
            savedMovements = savedMovements.filter(movement => movement.id != id);
            localStorage.setItem('movements', JSON.stringify(savedMovements));
            loadSavedMovements();
            showUndoNotification();
        }
        
        function showUndoNotification() {
            const undoDiv = document.createElement('div');
            undoDiv.style.position = 'fixed';
            undoDiv.style.bottom = '30px';
            undoDiv.style.left = '30px';
            undoDiv.style.background = '#2c3e50';
            undoDiv.style.color = '#fff';
            undoDiv.style.padding = '15px 20px';
            undoDiv.style.borderRadius = '8px';
            undoDiv.innerHTML = 'ØªÙ… Ø§Ù„Ø­Ø°Ù <button style="margin-right:10px;padding:5px 10px;background:#e74c3c;color:#fff;border:none;border-radius:4px;cursor:pointer;">ØªØ±Ø§Ø¬Ø¹</button>';
            document.body.appendChild(undoDiv);
            const undoBtn = undoDiv.querySelector('button');
            undoBtn.addEventListener('click', function() {
                undoDelete();
                document.body.removeChild(undoDiv);
            });
            setTimeout(() => {
                if (document.body.contains(undoDiv)) {
                    document.body.removeChild(undoDiv);
                }
            }, 5000);
        }
        
        function undoDelete() {
            if (lastDeletedMovement) {
                let savedMovements = JSON.parse(localStorage.getItem('movements')) || [];
                savedMovements.push(lastDeletedMovement);
                localStorage.setItem('movements', JSON.stringify(savedMovements));
                alert('âœ… ØªÙ… Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ø§Ù„Ø­Ø°Ù.');
                lastDeletedMovement = null;
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø·Ø¨Ø§Ø¹Ø© Ø­Ø±ÙƒØ© Ù…Ø­ÙÙˆØ¸Ø©
        function printSavedMovement(id) {
            const savedMovements = JSON.parse(localStorage.getItem('movements')) || [];
            const movement = savedMovements.find(m => m.id == id);
            
            if (!movement) {
                alert('Ø§Ù„Ø­Ø±ÙƒØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
                return;
            }
            
            let tableRows = '';
            let suspendedTotal = 0; // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª
            
            movement.movements.forEach((item, index) => {
                // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª
                if (item.type === 'Ù…Ø³Ø³Ù„Ù… Ù…Ø¹Ù„Ù‚Ø§Øª Ø³Ø§Ø¨Ù‚Ù‡') {
                    suspendedTotal += item.total;
                }
                
                tableRows += `<tr>
                    <td>${index + 1}</td>
                    <td>${item.amount}</td>
                    <td>${item.currency}</td>
                    <td>${item.description}</td>
                    <td>${item.type}</td>
                    <td>${item.exchangeRate}</td>
                    <td>${item.total.toFixed(2)}</td>
                </tr>`;
            });
            
            // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙØ§Ø±Ù‚
            const difference = movement.totalAmount - movement.requiredAmount - suspendedTotal;
            
            const html = `
                <div class="print-header">
                    <h2>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ù„Ù„Ù…ÙˆØ¸Ù</h2>
                    <p>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù: ${movement.employeeName}</p>
                    <p>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${movement.note || "â€”"}</p> <!-- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ù†Ø§ -->
                    <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø±ÙƒØ©: ${movement.date}</p>
                    <p>Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„: ${movement.id}</p>
                </div>
                <table class="print-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                            <th>Ø§Ù„Ø¹Ù…Ù„Ø©</th>
                            <th>Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                            <th>Ø§Ù„Ù†ÙˆØ¹</th>
                            <th>Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù</th>
                            <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                        </tr>
                    </thead>
                    <tbody>${tableRows}</tbody>
                </table>
                <div style="margin-top:20px;">
                    <table class="print-table">
                        <thead>
                            <tr>
                                <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø±ÙƒØ§Øª</th>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</th>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙØ§Ø±Ù‚</th>
                                <th>Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§Ø±Ù‚</th>
                                <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="print-total-row">
                                <td>${movement.totalAmount.toFixed(2)} Ø±ÙŠØ§Ù„</td>
                                <td>${movement.requiredAmount.toFixed(2)} Ø±ÙŠØ§Ù„</td>
                                <td>${Math.abs(difference).toFixed(2)} Ø±ÙŠØ§Ù„</td>
                                <td>${movement.status === 'match' ? 'Ù…Ø·Ø§Ø¨Ù‚' : movement.status === 'excess' ? 'Ø²ÙŠØ§Ø¯Ø©' : 'Ù†Ù‚Øµ'}</td>
                                <td>${suspendedTotal.toFixed(2)} Ø±ÙŠØ§Ù„</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="print-footer">
                    <p>Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© - Ø¨Ø±Ù…Ø¬Ù‡ ÙˆØªØ·ÙˆÙŠØ± /Ø¬Ø§ÙˆØ¯ Ø§Ù„Ø­ÙŠØ¯Ø±ÙŠ &copy; ${new Date().getFullYear()}</p>
                </div>
            `;
            
            const printWindow = document.getElementById('print-window');
            const printContent = document.getElementById('print-content');
            printContent.innerHTML = html;
            printWindow.style.display = 'block';
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±ÙØ§Ù‚ Ø­Ø¯Ø« Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
            document.getElementById('print-close').addEventListener('click', function() {
                printWindow.style.display = 'none';
            });
        }
        
        // Ø¯Ø§Ù„Ø© Ù„ØªØµØ¯ÙŠØ± Ø­Ø±ÙƒØ© Ø¥Ù„Ù‰ PDF
        function exportMovementToPDF(id) {
            const savedMovements = JSON.parse(localStorage.getItem('movements')) || [];
            const movement = savedMovements.find(m => m.id == id);
            
            if (!movement) {
                alert('Ø§Ù„Ø­Ø±ÙƒØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
                return;
            }
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø© jsPDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³ØªÙ†Ø¯
            doc.setFontSize(16);
            doc.text('ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©', 105, 15, null, null, 'center');
            doc.setFontSize(12);
            doc.text(`Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù: ${movement.employeeName}`, 15, 25);
            doc.text(`Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${movement.note || "â€”"}`, 15, 35); // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ù†Ø§
            doc.text(`ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø±ÙƒØ©: ${movement.date}`, 15, 45);
            doc.text(`Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„: ${movement.id}`, 15, 55);
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            const headers = ['#', 'Ø§Ù„Ù…Ø¨Ù„Øº', 'Ø§Ù„Ø¹Ù…Ù„Ø©', 'Ø§Ù„Ø¨ÙŠØ§Ù†', 'Ø§Ù„Ù†ÙˆØ¹', 'Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù', 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ'];
            const rows = movement.movements.map((item, index) => [
                index + 1,
                item.amount,
                item.currency,
                item.description,
                item.type,
                item.exchangeRate,
                item.total
            ]);
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙ†Ø¯
            doc.autoTable({
                startY: 60,
                head: [headers],
                body: rows,
                theme: 'grid',
                headStyles: { 
                    fillColor: [44, 62, 80],
                    textColor: 255,
                    fontStyle: 'bold'
                },
                styles: { 
                    font: 'Tajawal',
                    fontStyle: 'normal',
                    textColor: [0, 0, 0],
                    cellPadding: 3,
                    fontSize: 10
                },
                columnStyles: {
                    0: { cellWidth: 15 },
                    1: { cellWidth: 30 },
                    2: { cellWidth: 30 },
                    3: { cellWidth: 50 },
                    4: { cellWidth: 40 },
                    5: { cellWidth: 30 },
                    6: { cellWidth: 30 }
                },
                margin: { top: 60 }
            });
            
            // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª
            const suspendedTotal = movement.movements
                .filter(item => item.type === 'Ù…Ø³Ø³Ù„Ù… Ù…Ø¹Ù„Ù‚Ø§Øª Ø³Ø§Ø¨Ù‚Ù‡')
                .reduce((sum, item) => sum + item.total, 0);
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙØ§Ø±Ù‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            const difference = movement.totalAmount - movement.requiredAmount - suspendedTotal;
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ø®Øµ
            const summaryY = doc.lastAutoTable.finalY + 10;
            doc.setFontSize(14);
            doc.text('Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ', 105, summaryY, null, null, 'center');
            
            const summary = [
                [`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø±ÙƒØ§Øª: ${movement.totalAmount.toFixed(2)} Ø±ÙŠØ§Ù„`],
                [`Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ${movement.requiredAmount.toFixed(2)} Ø±ÙŠØ§Ù„`],
                [`Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙØ§Ø±Ù‚: ${Math.abs(difference).toFixed(2)} Ø±ÙŠØ§Ù„`],
                [`Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§Ø±Ù‚: ${movement.status === 'match' ? 'Ù…Ø·Ø§Ø¨Ù‚' : movement.status === 'excess' ? 'Ø²ÙŠØ§Ø¯Ø©' : 'Ù†Ù‚Øµ'}`],
                [`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª: ${suspendedTotal.toFixed(2)} Ø±ÙŠØ§Ù„`]
            ];
            
            doc.autoTable({
                startY: summaryY + 10,
                body: summary,
                theme: 'plain',
                styles: { 
                    font: 'Tajawal',
                    fontStyle: 'bold',
                    textColor: [0, 0, 0],
                    cellPadding: 3,
                    fontSize: 12
                },
                margin: { left: 15 }
            });
            
            // Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªÙ†Ø¯
            doc.save(`ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø­Ø±ÙƒØ©_${movement.id}.pdf`);
        }
        
        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø­Ø±ÙƒØ© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
        function loadMovementForEditing(id) {
            const savedMovements = JSON.parse(localStorage.getItem('movements')) || [];
            const movement = savedMovements.find(m => m.id == id);
            
            if (!movement) {
                alert('Ø§Ù„Ø­Ø±ÙƒØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
                return;
            }
            
            // ØªØ¹ÙŠÙŠÙ† Ù…Ø¹Ø±Ù Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø­Ø§Ù„ÙŠ
            currentEditId = id;
            
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            document.getElementById('employee-name').value = movement.employeeName;
            document.getElementById('employee-note').value = movement.note || ""; // ØªØ¹Ø¨Ø¦Ø© Ø­Ù‚Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
            document.getElementById('movement-date').value = movement.date;
            document.getElementById('required-amount').value = movement.requiredAmount;
            document.getElementById('serial-number').textContent = movement.id;
            
            // Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            document.querySelectorAll('#movements-body tr').forEach(row => row.remove());
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            movement.movements.forEach((item, index) => {
                const tableBody = document.getElementById('movements-body');
                const newRow = document.createElement('tr');
                
                newRow.innerHTML = `
                    <td>${index + 1}</td>
                    <td><input type="number" class="amount-input" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" step="0.01" value="${item.amount}"></td>
                    <td>
                        <select class="currency-select">
                            <option value="YER" ${item.currency === 'YER' ? 'selected' : ''}>Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ</option>
                            <option value="SAR" ${item.currency === 'SAR' ? 'selected' : ''}>Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</option>
                            <option value="USD" ${item.currency === 'USD' ? 'selected' : ''}>Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ</option>
                        </select>
                    </td>
                    <td><input type="text" class="description-input" placeholder="Ø§Ù„Ø¨ÙŠØ§Ù†" value="${item.description}"></td>
                    <td>
                        <select class="type-select">
                            <option value="Ù…ÙˆØ¸ÙÙŠÙ†" ${item.type === 'Ù…ÙˆØ¸ÙÙŠÙ†' ? 'selected' : ''}>Ù…ÙˆØ¸ÙÙŠÙ†</option>
                            <option value="Ù…Ø¹Ù„Ù‚Ø§Øª" ${item.type === 'Ù…Ø¹Ù„Ù‚Ø§Øª' ? 'selected' : ''}>Ù…Ø¹Ù„Ù‚Ø§Øª</option>
                            <option value="Ø³Ø¯Ø§Ø¯Ù…ÙˆØ±Ø¯ÙŠÙ†" ${item.type === 'Ø³Ø¯Ø§Ø¯Ù…ÙˆØ±Ø¯ÙŠÙ†' ? 'selected' : ''}>Ø³Ø¯Ø§Ø¯Ù…ÙˆØ±Ø¯ÙŠÙ†</option>
                            <option value="Ù…ØµØ±ÙˆÙØ§Øª" ${item.type === 'Ù…ØµØ±ÙˆÙØ§Øª' ? 'selected' : ''}>Ù…ØµØ±ÙˆÙØ§Øª</option>
                            <option value="Ø§Ù„Ù…Ø¯ÙŠØ±" ${item.type === 'Ø§Ù„Ù…Ø¯ÙŠØ±' ? 'selected' : ''}>Ø§Ù„Ù…Ø¯ÙŠØ±</option>
                            <option value="ÙÙˆØ§ØªÙŠØ± Ù…Ø´ØªØ±ÙŠØ§Øª" ${item.type === 'ÙÙˆØ§ØªÙŠØ± Ù…Ø´ØªØ±ÙŠØ§Øª' ? 'selected' : ''}>ÙÙˆØ§ØªÙŠØ± Ù…Ø´ØªØ±ÙŠØ§Øª</option>
                            <option value="Ù†Ù‚Ø¯ÙŠÙ‡" ${item.type === 'Ù†Ù‚Ø¯ÙŠÙ‡' ? 'selected' : ''}>Ù†Ù‚Ø¯ÙŠÙ‡</option>
                            <option value="Ø§Ø®Ø±Ù‰" ${item.type === 'Ø§Ø®Ø±Ù‰' ? 'selected' : ''}>Ø§Ø®Ø±Ù‰</option>
                            <option value="Ù…Ø³Ø³Ù„Ù… Ù…Ø¹Ù„Ù‚Ø§Øª Ø³Ø§Ø¨Ù‚Ù‡" ${item.type === 'Ù…Ø³Ø³Ù„Ù… Ù…Ø¹Ù„Ù‚Ø§Øª Ø³Ø§Ø¨Ù‚Ù‡' ? 'selected' : ''}>Ù…Ø³Ø³Ù„Ù… Ù…Ø¹Ù„Ù‚Ø§Øª Ø³Ø§Ø¨Ù‚Ù‡</option>
                        </select>
                    </td>
                    <td><input type="number" class="exchange-input" value="${item.exchangeRate}" step="0.01" ${item.currency === 'YER' ? 'disabled' : ''}></td>
                    <td class="total-cell">${item.total}</td>
                    <td class="attachment-cell">
                        <button class="attachment-btn">
                            <i class="fas fa-paperclip"></i>
                        </button>
                        <input type="file" class="attachment-input" accept="image/*,.pdf">
                        <img class="attachment-preview" style="display:none">
                    </td>
                    <td class="action-buttons">
                        <button class="action-btn delete"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                
                tableBody.appendChild(newRow);
                addRowEvents(newRow);
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø±ÙÙ‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                if (item.attachmentId) {
                    const attachmentPreview = newRow.querySelector('.attachment-preview');
                    const attachment = JSON.parse(localStorage.getItem("attachments"))[item.attachmentId];
                    if (attachment && attachment.type.startsWith('image/')) {
                        attachmentPreview.src = `data:${attachment.type};base64,${attachment.data}`;
                        attachmentPreview.style.display = 'block';
                    }
                }
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª ÙˆØ¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            document.getElementById('update-btn').style.display = 'inline-block';
            document.getElementById('confirm-save-btn').style.display = 'none';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø®Øµ
            updateSummary();
            
            // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ Ù‚Ø³Ù… Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
            document.querySelectorAll('.dept-item').forEach(i => i.classList.remove('active'));
            document.querySelector('[data-section="input"]').classList.add('active');
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('input-section').classList.add('active');
            
            alert('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ - Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± "Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª" Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡');
        }
        
        // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
        async function updateMovement() {
            if (!currentEditId) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ© Ù…Ø­Ù…Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„');
                return;
            }
            
            const employeeName = document.getElementById('employee-name').value;
            const note = document.getElementById('employee-note').value; // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
            const movementDate = document.getElementById('movement-date').value;
            const requiredAmount = parseFloat(document.getElementById('required-amount').value) || 0;
            
            // Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„
            const movements = [];
            const rows = document.querySelectorAll('#movements-body tr');
            let totalAmount = 0;
            let suspendedTotal = 0; // Ø¥Ø¶Ø§ÙØ© Ù…ØªØºÙŠØ± Ù„Ø¬Ù…Ø¹ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª
            
            for (const row of rows) {
                const amount = parseFloat(row.querySelector('.amount-input').value) || 0;
                const currency = row.querySelector('.currency-select').value;
                const description = row.querySelector('.description-input').value;
                const type = row.querySelector('.type-select').value;
                const exchangeRate = parseFloat(row.querySelector('.exchange-input').value) || 1;
                const total = parseFloat(row.querySelector('.total-cell').textContent) || 0;
                
                // Ø­ÙØ¸ Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª
                const attachmentInput = row.querySelector('.attachment-input');
                let attachmentId = null;
                if (attachmentInput.files.length > 0) {
                    const file = attachmentInput.files[0];
                    attachmentId = await saveAttachment(file);
                }
                
                movements.push({
                    amount,
                    currency,
                    description,
                    type,
                    exchangeRate,
                    total,
                    attachmentId
                });
                
                totalAmount += total;
                
                // Ø¬Ù…Ø¹ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª
                if (type === 'Ù…Ø³Ø³Ù„Ù… Ù…Ø¹Ù„Ù‚Ø§Øª Ø³Ø§Ø¨Ù‚Ù‡') {
                    suspendedTotal += total;
                }
            }
            
            // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ§Ø±Ù‚ Ù…Ø¹ Ø·Ø±Ø­ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª
            const difference = totalAmount - requiredAmount - suspendedTotal;
            let status;
            if (difference === 0) {
                status = 'match';
            } else if (difference > 0) {
                status = 'excess';
            } else {
                status = 'shortage';
            }
            
            // ØªØ­Ø¯ÙŠØ« ÙƒØ§Ø¦Ù† Ø§Ù„Ø­Ø±ÙƒØ©
            const updatedMovement = {
                id: currentEditId,
                employeeName,
                note, // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
                date: movementDate,
                movements,
                totalAmount,
                requiredAmount,
                difference: Math.abs(difference),
                status,
                suspendedTotal
            };
            
            // ØªØ­Ø¯ÙŠØ« localStorage
            let savedMovements = JSON.parse(localStorage.getItem("movements")) || [];
            const index = savedMovements.findIndex(m => m.id == currentEditId);
            
            if (index !== -1) {
                savedMovements[index] = updatedMovement;
                localStorage.setItem("movements", JSON.stringify(savedMovements));
                alert(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø±ÙƒØ© Ø±Ù‚Ù… ${currentEditId} Ø¨Ù†Ø¬Ø§Ø­`);
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                document.getElementById('update-btn').style.display = 'none';
                document.getElementById('confirm-save-btn').style.display = 'inline-block';
                currentEditId = null;
                
                // ØªØ­Ø¯ÙŠØ« Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
                loadSavedMovements();
            } else {
                alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø±ÙƒØ© Ù„Ù„ØªØ­Ø¯ÙŠØ«');
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        function resetForm() {
            document.getElementById('update-btn').style.display = 'none';
            document.getElementById('confirm-save-btn').style.display = 'inline-block';
            currentEditId = null;
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('employee-name').value = '';
            document.getElementById('employee-note').value = ''; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
            document.getElementById('movement-date').valueAsDate = new Date();
            document.getElementById('required-amount').value = '';
            document.getElementById('suspended-total').textContent = '0.00 Ø±ÙŠØ§Ù„';
            document.querySelectorAll('#movements-body tr').forEach(row => row.remove());
            addNewRow();
            updateSummary();
        }
        
        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©
        function loadDetailedReports() {
            const savedMovements = JSON.parse(localStorage.getItem('movements')) || [];
            const tableBody = document.querySelector('#detailed-reports-table tbody');
            tableBody.innerHTML = '';
            
            // ØªÙØ±ÙŠØº Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ø¬Ø¯ÙˆÙ„ ØªÙØµÙŠÙ„ÙŠ
            savedMovements.forEach(movement => {
                movement.movements.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${movement.employeeName}</td>
                        <td>${movement.date}</td>
                        <td>${movement.note || "â€”"}</td> <!-- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
                        <td>${item.amount}</td>
                        <td>${item.currency}</td>
                        <td>${item.description}</td>
                        <td>${item.type}</td>
                        <td>${item.exchangeRate}</td>
                        <td>${item.total.toFixed(2)}</td>
                    `;
                    tableBody.appendChild(row);
                });
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙÙ„ØªØ±
            updateFilteredTotal();
        }
        
        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…ÙÙ„ØªØ±Ø©
        function updateFilteredTotal() {
            const rows = document.querySelectorAll('#detailed-reports-table tbody tr');
            let total = 0;
            
            rows.forEach(row => {
                if (row.style.display !== 'none') {
                    const totalCell = row.cells[8];
                    total += parseFloat(totalCell.textContent) || 0;
                }
            });
            
            document.getElementById('filtered-total').textContent = total.toFixed(2);
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø¹Ù†Ø§ØµØ± ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ÙÙ„ØªØ±Ø©
        function addFilterControl(filterType) {
            const filterControls = document.getElementById('filter-controls');
            let controlHtml = '';
            
            switch(filterType) {
                case 'employee':
                    controlHtml = `
                        <div class="input-row">
                            <div class="input-group">
                                <label><i class="fas fa-user"></i> ÙÙ„ØªØ±Ø© Ø¨Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</label>
                                <input id="filter-detailed-employee" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù" type="text">
                            </div>
                        </div>
                    `;
                    break;
                case 'date':
                    controlHtml = `
                        <div class="input-row">
                            <div class="input-group">
                                <label><i class="fas fa-calendar"></i> ÙÙ„ØªØ±Ø© Ø¨Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                                <input id="filter-detailed-date" type="date">
                            </div>
                        </div>
                    `;
                    break;
                case 'amount':
                    controlHtml = `
                        <div class="input-row">
                            <div class="input-group">
                                <label><i class="fas fa-money-bill"></i> ÙÙ„ØªØ±Ø© Ø¨Ø§Ù„Ù…Ø¨Ù„Øº</label>
                                <div style="display: flex; gap: 10px;">
                                    <input id="filter-detailed-amount-min" placeholder="Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰" style="flex: 1;" type="number">
                                    <input id="filter-detailed-amount-max" placeholder="Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰" style="flex: 1;" type="number">
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'currency':
                    controlHtml = `
                        <div class="input-row">
                            <div class="input-group">
                                <label><i class="fas fa-coins"></i> ÙÙ„ØªØ±Ø© Ø¨Ø§Ù„Ø¹Ù…Ù„Ø©</label>
                                <select id="filter-detailed-currency">
                                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Øª</option>
                                    <option value="YER">Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ</option>
                                    <option value="SAR">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</option>
                                    <option value="USD">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ</option>
                                </select>
                            </div>
                        </div>
                    `;
                    break;
                case 'description':
                    controlHtml = `
                        <div class="input-row">
                            <div class="input-group">
                                <label><i class="fas fa-comment"></i> ÙÙ„ØªØ±Ø© Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†</label>
                                <input id="filter-detailed-description" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†" type="text">
                            </div>
                        </div>
                    `;
                    break;
                case 'exchange':
                    controlHtml = `
                        <div class="input-row">
                            <div class="input-group">
                                <label><i class="fas fa-exchange-alt"></i> ÙÙ„ØªØ±Ø© Ø¨Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù</label>
                                <div style="display: flex; gap: 10px;">
                                    <input id="filter-detailed-exchange-min" placeholder="Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰" style="flex: 1;" type="number">
                                    <input id="filter-detailed-exchange-max" placeholder="Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰" style="flex: 1;" type="number">
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'total':
                    controlHtml = `
                        <div class="input-row">
                            <div class="input-group">
                                <label><i class="fas fa-calculator"></i> ÙÙ„ØªØ±Ø© Ø¨Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</label>
                                <div style="display: flex; gap: 10px;">
                                    <input id="filter-detailed-total-min" placeholder="Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰" style="flex: 1;" type="number">
                                    <input id="filter-detailed-total-max" placeholder="Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰" style="flex: 1;" type="number">
                                </div>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            filterControls.innerHTML += controlHtml;
            
            // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            document.querySelectorAll('#filter-controls input, #filter-controls select').forEach(input => {
                input.addEventListener('input', function() {
                    filterDetailedTable();
                    updateFilteredTotal();
                });
            });
        }
        
        // Ø¯Ø§Ù„Ø© Ù„ÙÙ„ØªØ±Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ
        function filterDetailedTable() {
            const rows = document.querySelectorAll('#detailed-reports-table tbody tr');
            
            rows.forEach(row => {
                const employee = row.cells[0].textContent.toLowerCase();
                const date = row.cells[1].textContent;
                const note = row.cells[2].textContent.toLowerCase();
                const amount = parseFloat(row.cells[3].textContent);
                const currency = row.cells[4].textContent;
                const description = row.cells[5].textContent.toLowerCase();
                const type = row.cells[6].textContent.toLowerCase();
                const exchange = parseFloat(row.cells[7].textContent);
                const total = parseFloat(row.cells[8].textContent);
                
                let show = true;
                
                // ÙÙ„ØªØ±Ø© Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù
                const filterEmployee = document.getElementById('filter-detailed-employee');
                if (filterEmployee && filterEmployee.value) {
                    if (!employee.includes(filterEmployee.value.toLowerCase())) {
                        show = false;
                    }
                }
                
                // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
                const filterNote = document.getElementById('filter-detailed-note');
                if (filterNote && filterNote.value) {
                    if (!note.includes(filterNote.value.toLowerCase())) {
                        show = false;
                    }
                }
                
                // ÙÙ„ØªØ±Ø© Ø§Ù„ØªØ§Ø±ÙŠØ®
                const filterDate = document.getElementById('filter-detailed-date');
                if (filterDate && filterDate.value) {
                    if (date !== filterDate.value) {
                        show = false;
                    }
                }
                
                // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ø¨Ù„Øº
                const filterAmountMin = document.getElementById('filter-detailed-amount-min');
                const filterAmountMax = document.getElementById('filter-detailed-amount-max');
                if (filterAmountMin && filterAmountMin.value) {
                    if (amount < parseFloat(filterAmountMin.value)) {
                        show = false;
                    }
                }
                if (filterAmountMax && filterAmountMax.value) {
                    if (amount > parseFloat(filterAmountMax.value)) {
                        show = false;
                    }
                }
                
                // ÙÙ„ØªØ±Ø© Ø§Ù„Ø¹Ù…Ù„Ø©
                const filterCurrency = document.getElementById('filter-detailed-currency');
                if (filterCurrency && filterCurrency.value) {
                    if (currency !== filterCurrency.value) {
                        show = false;
                    }
                }
                
                // ÙÙ„ØªØ±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†
                const filterDescription = document.getElementById('filter-detailed-description');
                if (filterDescription && filterDescription.value) {
                    if (!description.includes(filterDescription.value.toLowerCase())) {
                        show = false;
                    }
                }
                
                // ÙÙ„ØªØ±Ø© Ø§Ù„Ù†ÙˆØ¹
                const filterType = document.getElementById('filter-detailed-type');
                if (filterType && filterType.value) {
                    if (!type.includes(filterType.value.toLowerCase())) {
                        show = false;
                    }
                }
                
                // ÙÙ„ØªØ±Ø© Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù
                const filterExchangeMin = document.getElementById('filter-detailed-exchange-min');
                const filterExchangeMax = document.getElementById('filter-detailed-exchange-max');
                if (filterExchangeMin && filterExchangeMin.value) {
                    if (exchange < parseFloat(filterExchangeMin.value)) {
                        show = false;
                    }
                }
                if (filterExchangeMax && filterExchangeMax.value) {
                    if (exchange > parseFloat(filterExchangeMax.value)) {
                        show = false;
                    }
                }
                
                // ÙÙ„ØªØ±Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                const filterTotalMin = document.getElementById('filter-detailed-total-min');
                const filterTotalMax = document.getElementById('filter-detailed-total-max');
                if (filterTotalMin && filterTotalMin.value) {
                    if (total < parseFloat(filterTotalMin.value)) {
                        show = false;
                    }
                }
                if (filterTotalMax && filterTotalMax.value) {
                    if (total > parseFloat(filterTotalMax.value)) {
                        show = false;
                    }
                }
                
                row.style.display = show ? '' : 'none';
            });
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ„ØªØ±
        function resetDetailedFilter() {
            document.getElementById('filter-controls').innerHTML = '';
            document.querySelectorAll('#detailed-reports-table tbody tr').forEach(row => {
                row.style.display = '';
            });
            updateFilteredTotal();
        }
        
        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ù…Ù„Ø®Øµ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª
        function updateAnalyticsSummary() {
            const savedMovements = JSON.parse(localStorage.getItem("movements")) || [];
            if (savedMovements.length === 0) return;
            
            let totalMovements = 0;
            const employeeTotals = {};
            const descriptionCounts = {};
            
            savedMovements.forEach(movement => {
                totalMovements += movement.totalAmount;
                
                // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
                if (!employeeTotals[movement.employeeName]) {
                    employeeTotals[movement.employeeName] = 0;
                }
                employeeTotals[movement.employeeName] += movement.totalAmount;
                
                // Ø­Ø³Ø§Ø¨ ØªÙƒØ±Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                movement.movements.forEach(item => {
                    if (!descriptionCounts[item.description]) {
                        descriptionCounts[item.description] = 0;
                    }
                    descriptionCounts[item.description]++;
                });
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ
            document.getElementById('total-movements').textContent = totalMovements.toLocaleString('ar') + ' Ø±ÙŠØ§Ù„';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø£ÙƒØ«Ø± Ø­Ø±ÙƒØ©
            let topEmployee = '';
            let maxEmployeeTotal = 0;
            for (const [employee, total] of Object.entries(employeeTotals)) {
                if (total > maxEmployeeTotal) {
                    maxEmployeeTotal = total;
                    topEmployee = employee;
                }
            }
            document.getElementById('top-employee').textContent = topEmployee || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù† Ø§Ù„Ø£ÙƒØ«Ø± ØªÙƒØ±Ø§Ø±Ù‹Ø§
            let topDescription = '';
            let maxDescriptionCount = 0;
            for (const [description, count] of Object.entries(descriptionCounts)) {
                if (count > maxDescriptionCount) {
                    maxDescriptionCount = count;
                    topDescription = description;
                }
            }
            document.getElementById('top-description').textContent = topDescription || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
        function generateCharts() {
            const savedMovements = JSON.parse(localStorage.getItem("movements")) || [];
            if (savedMovements.length === 0) {
                document.getElementById('analytics-section').innerHTML = `
                    <div class="input-section">
                        <h2 style="text-align: center; color: var(--primary); margin: 50px 0;">
                            <i class="fas fa-database"></i> Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ© Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
                        </h2>
                        <p style="text-align: center;">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø£ÙˆÙ„Ø§Ù‹</p>
                    </div>
                `;
                return;
            }
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
            const currencyData = { YER: 0, SAR: 0, USD: 0 };
            const employeeData = {};
            const descriptionData = {};
            let totalRequired = 0;
            let totalActual = 0;
            
            savedMovements.forEach(movement => {
                totalRequired += movement.requiredAmount;
                totalActual += movement.totalAmount;
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
                movement.movements.forEach(item => {
                    currencyData[item.currency] += item.amount;
                });
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
                if (!employeeData[movement.employeeName]) {
                    employeeData[movement.employeeName] = 0;
                }
                employeeData[movement.employeeName] += movement.totalAmount;
                
                // Ø­Ø³Ø§Ø¨ ØªÙƒØ±Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                movement.movements.forEach(item => {
                    if (item.description) {
                        if (!descriptionData[item.description]) {
                            descriptionData[item.description] = 0;
                        }
                        descriptionData[item.description]++;
                    }
                });
            });
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø®Ø·Ø· ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
            const currencyCtx = document.getElementById('currency-chart').getContext('2d');
            new Chart(currencyCtx, {
                type: 'pie',
                data: {
                    labels: ['Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ', 'Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ', 'Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ'],
                    datasets: [{
                        data: [currencyData.YER, currencyData.SAR, currencyData.USD],
                        backgroundColor: ['#3498db', '#2ecc71', '#9b59b6']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            rtl: true
                        }
                    }
                }
            });
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø®Ø·Ø· Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
            const comparisonCtx = document.getElementById('comparison-chart').getContext('2d');
            new Chart(comparisonCtx, {
                type: 'bar',
                data: {
                    labels: ['Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨', 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙØ¹Ù„ÙŠ'],
                    datasets: [{
                        label: 'Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„ÙŠÙ…Ù†ÙŠ',
                        data: [totalRequired, totalActual],
                        backgroundColor: ['#3498db', '#2ecc71']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø®Ø·Ø· Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
            const employeeCtx = document.getElementById('employee-chart').getContext('2d');
            new Chart(employeeCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(employeeData),
                    datasets: [{
                        data: Object.values(employeeData),
                        backgroundColor: ['#3498db', '#2ecc71', '#9b59b6', '#e74c3c', '#f39c12']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            rtl: true
                        }
                    }
                }
            });
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø®Ø·Ø· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± ØªÙƒØ±Ø§Ø±Ù‹Ø§
            const descriptionCtx = document.getElementById('description-chart').getContext('2d');
            
            // ØªØ­ÙˆÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ§Øª
            const descriptionLabels = Object.keys(descriptionData);
            const descriptionValues = Object.values(descriptionData);
            
            // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø£Ø´Ø±Ø·Ø© Ø¨Ø´ÙƒÙ„ Ù…ØªØ¯Ø±Ø¬
            const backgroundColors = descriptionLabels.map((_, index) => {
                const hue = (index * 137.5) % 360; // Ø²ÙˆØ§ÙŠØ§ Ù…ØªØ¨Ø§Ø¹Ø¯Ø© Ù„ØªÙˆÙ„ÙŠØ¯ Ø£Ù„ÙˆØ§Ù† Ù…Ø®ØªÙ„ÙØ©
                return `hsl(${hue}, 70%, 60%)`;
            });
            
            new Chart(descriptionCtx, {
                type: 'bar',
                data: {
                    labels: descriptionLabels,
                    datasets: [{
                        label: 'ØªÙƒØ±Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†',
                        data: descriptionValues,
                        backgroundColor: backgroundColors
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function printInputData() {
            const employeeName = document.getElementById('employee-name').value || "â€”";
            const note = document.getElementById('employee-note').value || "â€”"; // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
            const movementDate = document.getElementById('movement-date').value || "â€”";
            const serialNumber = document.getElementById('serial-number').innerText || "â€”";

            const rows = document.querySelectorAll('#movements-body tr');
            let tableRows = '';
            let suspendedTotal = 0;
            
            rows.forEach((row, index) => {
                const amount = row.querySelector('.amount-input')?.value || "";
                const currency = row.querySelector('.currency-select')?.value || "";
                const description = row.querySelector('.description-input')?.value || "";
                const type = row.querySelector('.type-select')?.value || "";
                const exchange = row.querySelector('.exchange-input')?.value || "";
                const total = row.querySelector('.total-cell')?.innerText || "";
                
                // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª
                if (type === 'Ù…Ø³Ø³Ù„Ù… Ù…Ø¹Ù„Ù‚Ø§Øª Ø³Ø§Ø¨Ù‚Ù‡') {
                    suspendedTotal += parseFloat(total) || 0;
                }
                
                tableRows += `
                    <tr>
                        <td>${amount}</td>
                        <td>${currency}</td>
                        <td>${description}</td>
                        <td>${type}</td>
                        <td>${exchange}</td>
                        <td>${total}</td>
                    </tr>
                `;
            });

            const totalAmount = document.getElementById('total-amount')?.innerText || "0.00 Ø±ÙŠØ§Ù„";
            const requiredAmount = document.getElementById('required-amount')?.value || "0.00";
            const differenceAmount = document.getElementById('difference-amount')?.innerText || "0.00 Ø±ÙŠØ§Ù„";
            const status = document.getElementById('status-box')?.innerText || "";

            let printWindow = window.open('', '', 'width=900,height=750');
            printWindow.document.write(`
                <html>
                <head>
                    <title>ØªÙ‚Ø±ÙŠØ± Ø­Ø±ÙƒØ© Ø§Ù„Ù…ÙˆØ¸Ù</title>
                    <style>
                        body { font-family: 'Tajawal', sans-serif; direction: rtl; margin: 30px; }
                        h2 { text-align: center; color: #007bff; }
                        .info-header {
                            margin-bottom: 20px;
                        }
                        .info-header table {
                            width: 100%;
                            border-collapse: collapse;
                        }
                        .info-header td {
                            padding: 8px 12px;
                            font-size: 1.1rem;
                            font-weight: bold;
                            text-align: center;
                            border: 1px solid #ccc;
                        }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #000; padding: 8px; text-align: center; }
                        th { background-color: #f0f0f0; color: red; }
                        .summary-table { margin-top: 30px; }
                        .footer-note {
                            text-align: center;
                            margin-top: 40px;
                            font-style: italic;
                            font-size: 0.95rem;
                            color: #555;
                        }
                    
.app-container.collapsed .sidebar {
    width: 60px;
}
.app-container.collapsed .main-content {
    margin-right: 60px;
}
.app-container.collapsed .sidebar-header h2 span,
.app-container.collapsed .dept-item span,
.app-container.collapsed .user-info {
    display: none;
}

</style>
                </head>
                <body>
                    <h2>ØªÙ‚Ø±ÙŠØ± Ø­Ø±ÙƒØ© Ø§Ù„Ù…ÙˆØ¸Ù</h2>
                    <div class="info-header">
                        <table>
                            <tr>
                                <td>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù: ${employeeName}</td>
                                <td>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${note}</td> <!-- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ù†Ø§ -->
                                <td>Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„: ${serialNumber}</td>
                            </tr>
                            <tr>
                                <td>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø±ÙƒØ©: ${movementDate}</td>
                            </tr>
                        </table>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                <th>Ø§Ù„Ø¹Ù…Ù„Ø©</th>
                                <th>Ø§Ù„Ø¨ÙŠØ§Ù† Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ</th>
                                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                <th>Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù</th>
                                <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„ÙŠÙ…Ù†ÙŠ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${tableRows}
                        </tbody>
                    </table>
                    <table class="summary-table">
                        <thead>
                            <tr>
                                <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø±ÙƒØ§Øª</th>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</th>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙØ§Ø±Ù‚</th>
                                <th>Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§Ø±Ù‚</th>
                                <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>${totalAmount}</td>
                                <td>${requiredAmount} Ø±ÙŠØ§Ù„</td>
                                <td>${differenceAmount}</td>
                                <td>${status}</td>
                                <td>${suspendedTotal.toFixed(2)} Ø±ÙŠØ§Ù„</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="footer-note">
                        <p>ØªÙ… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¨ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleDateString('ar-YE')}</p>
                        <p>Ø¨Ø±Ù…Ø¬Ø© ÙˆØªØ·ÙˆÙŠØ± / Ø¬Ø§ÙˆØ¯ Ø§Ù„Ø­ÙŠØ¯Ø±ÙŠ</p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.focus();
            printWindow.print();
            printWindow.close();
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© Ø§Ù„Ù…ÙÙ„ØªØ±Ø©
        function printDetailedReports() {
            const printWindow = document.getElementById('print-window');
            const printContent = document.getElementById('print-content');
            
            // Ø¨Ù†Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
            let content = `
                <div class="print-close" id="print-close">
                    <i class="fas fa-times"></i>
                </div>
                <div class="print-header">
                    <h2>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© - Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙÙ„ØªØ±Ø©</h2>
                    <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${new Date().toLocaleDateString('ar-YE')}</p>
                </div>
                <table class="print-table">
                    <thead>
                        <tr>
                            <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø±ÙƒÙ‡</th>
                            <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                            <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                            <th>Ø§Ù„Ø¹Ù…Ù„Ù‡</th>
                            <th>Ø§Ù„Ø¨ÙŠØ§Ù† Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ</th>
                            <th>Ø§Ù„Ù†ÙˆØ¹</th>
                            <th>Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù</th>
                            <th>Ø§Ù„Ø§Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„ÙŠÙ…Ù†ÙŠ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            let filteredTotal = 0;
            
            // Ø¬Ù…Ø¹ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ù…Ø±Ø¦ÙŠØ© ÙÙ‚Ø·
            document.querySelectorAll('#detailed-reports-table tbody tr').forEach(row => {
                if (row.style.display !== 'none') {
                    const totalValue = parseFloat(row.cells[8].textContent) || 0;
                    filteredTotal += totalValue;
                    
                    content += `
                        <tr>
                            <td>${row.cells[0].textContent}</td>
                            <td>${row.cells[1].textContent}</td>
                            <td>${row.cells[2].textContent}</td>
                            <td>${row.cells[3].textContent}</td>
                            <td>${row.cells[4].textContent}</td>
                            <td>${row.cells[5].textContent}</td>
                            <td>${row.cells[6].textContent}</td>
                            <td>${row.cells[7].textContent}</td>
                            <td>${row.cells[8].textContent}</td>
                        </tr>
                    `;
                }
            });
            
            content += `
                    </tbody>
                    <tfoot>
                        <tr class="print-total-row">
                            <td colspan="8" style="text-align: right; font-weight: bold;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ÙÙ„ØªØ± :</td>
                            <td style="font-weight: bold;">${filteredTotal.toFixed(2)} Ø±ÙŠØ§Ù„</td>
                        </tr>
                    </tfoot>
                </table>
                <div class="print-footer">
                    <p>Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© - Ø¨Ø±Ù…Ø¬Ù‡ ÙˆØªØ·ÙˆÙŠØ± / Ø¬Ø§ÙˆØ¯ Ø§Ù„Ø­ÙŠØ¯Ø±ÙŠ &copy; ${new Date().getFullYear()}</p>
                </div>
            `;
            
            printContent.innerHTML = content;
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±ÙØ§Ù‚ Ø­Ø¯Ø« Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
            document.getElementById('print-close').addEventListener('click', function() {
                printWindow.style.display = 'none';
            });
            
            printWindow.style.display = 'block';
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        function createBackup() {
            const savedMovements = localStorage.getItem('movements');
            const nextId = localStorage.getItem('nextId');
            
            if (!savedMovements) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø­ÙØ¸Ù‡Ø§');
                return;
            }
            
            const data = {
                movements: JSON.parse(savedMovements),
                nextId: nextId || 1,
                backupDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        function restoreBackup(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (!data.movements || !data.nextId) {
                        throw new Error('Ù…Ù„Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ØºÙŠØ± ØµØ§Ù„Ø­');
                    }
                    
                    localStorage.setItem('movements', JSON.stringify(data.movements));
                    localStorage.setItem('nextId', data.nextId);
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                    loadSavedMovements();
                    loadDetailedReports();
                    updateAnalyticsSummary();
                    generateCharts();
                    
                    alert('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
                } catch (error) {
                    console.error('Error restoring backup:', error);
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©: ' + error.message);
                }
            };
            reader.readAsText(file);
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ù…Ø¹ Ø¯Ø¹Ù… Ø§Ù„ØªÙ‚Ø³ÙŠÙ… Ø¥Ù„Ù‰ ØµÙØ­Ø§Øª
        function printAllMovements() {
            const savedMovements = JSON.parse(localStorage.getItem('movements')) || [];
            if (savedMovements.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©');
                return;
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ø·Ø¨Ø§Ø¹Ø©
            const printWin = window.open('', '_blank', 'width=900,height=700');
            printWin.document.write(`
                <html>
                <head>
                    <title>Ø·Ø¨Ø§Ø¹Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø±ÙƒØ§Øª</title>
                    <style>
                        @media print {
                            body {
                                font-family: 'Tajawal', sans-serif;
                                direction: rtl;
                            }
                            table {
                                width: 100%;
                                border-collapse: collapse;
                                margin-bottom: 20px;
                            }
                            th, td {
                                border: 1px solid #000;
                                padding: 8px;
                                text-align: center;
                            }
                            th {
                                background-color: #f2f2f2;
                            }
                            .page-break {
                                page-break-after: always;
                            }
                            .print-header {
                                text-align: center;
                                margin-bottom: 20px;
                            }
                            .print-footer {
                                text-align: center;
                                margin-top: 20px;
                                font-style: italic;
                                color: #666;
                            }
                        }
                    
.app-container.collapsed .sidebar {
    width: 60px;
}
.app-container.collapsed .main-content {
    margin-right: 60px;
}
.app-container.collapsed .sidebar-header h2 span,
.app-container.collapsed .dept-item span,
.app-container.collapsed .user-info {
    display: none;
}

</style>
                </head>
                <body>
                    <div class="print-header">
                        <h1>ÙƒØ´Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h1>
                        <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${new Date().toLocaleDateString('ar-YE')}</p>
                    </div>
            `);
            
            // Ø¹Ø¯Ø¯ Ø§Ù„ØµÙÙˆÙ ÙÙŠ ÙƒÙ„ ØµÙØ­Ø©
            const rowsPerPage = 20;
            const totalPages = Math.ceil(savedMovements.length / rowsPerPage);
            
            for (let page = 0; page < totalPages; page++) {
                const start = page * rowsPerPage;
                const end = start + rowsPerPage;
                const pageMovements = savedMovements.slice(start, end);
                
                printWin.document.write(`
                    <table>
                        <thead>
                            <tr>
                                <th>Ø±Ù‚Ù…</th>
                                <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                                <th>Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</th>
                                <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                                <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù…</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø§Ù„ÙØ±Ù‚</th>
                            </tr>
                        </thead>
                        <tbody>
                `);
                
                pageMovements.forEach((movement, index) => {
                    const statusArabic = movement.status === 'match' ? 'Ù…Ø·Ø§Ø¨Ù‚' : 
                                       movement.status === 'excess' ? 'Ø²ÙŠØ§Ø¯Ø©' : 'Ù†Ù‚Øµ';
                    const diff = movement.difference ? movement.difference.toFixed(2) : '0.00';
                    
                    printWin.document.write(`
                        <tr>
                            <td>${start + index + 1}</td>
                            <td>${movement.employeeName}</td>
                            <td>${movement.date}</td>
                            <td>${movement.note || "â€”"}</td> <!-- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
                            <td>${movement.requiredAmount.toFixed(2)}</td>
                            <td>${movement.totalAmount.toFixed(2)}</td>
                            <td>${movement.suspendedTotal ? movement.suspendedTotal.toFixed(2) : '0.00'}</td>
                            <td>${statusArabic}</td>
                            <td>${diff}</td>
                        </tr>
                    `);
                });
                
                printWin.document.write(`
                        </tbody>
                    </table>
                    <div class="print-footer">
                        Ø§Ù„ØµÙØ­Ø© ${page + 1} Ù…Ù† ${totalPages}
                    </div>
                `);
                
                // Ø¥Ø¶Ø§ÙØ© ÙØ§ØµÙ„ ØµÙØ­Ø© Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©
                if (page < totalPages - 1) {
                    printWin.document.write('<div class="page-break"></div>');
                }
            }
            
            printWin.document.write(`
                    <div class="print-footer">
                        Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© - Ø¨Ø±Ù…Ø¬Ù‡ ÙˆØªØ·ÙˆÙŠØ± / Ø¬Ø§ÙˆØ¯ Ø§Ù„Ø­ÙŠØ¯Ø±ÙŠ
                    </div>
                </body>
                </html>
            `);
            
            printWin.document.close();
            printWin.print();
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function clearAllMovements() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ù…Ø­Ùˆ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) {
                // Ù…Ø³Ø­ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
                localStorage.clear();
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
                document.querySelector('#saved-movements-table tbody').innerHTML = '';
                document.querySelector('#detailed-reports-table tbody').innerHTML = '';
                document.querySelector('#movements-body').innerHTML = '';
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
                const tableBody = document.getElementById('movements-body');
                const newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td>1</td>
                    <td><input type="number" class="amount-input" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" step="0.01" value="1000"></td>
                    <td>
                        <select class="currency-select">
                            <option value="YER">Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ</option>
                            <option value="SAR">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</option>
                            <option value="USD">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ</option>
                        </select>
                    </td>
                    <td><input type="text" class="description-input" placeholder="Ø§Ù„Ø¨ÙŠØ§Ù†" value="Ù…ØµØ±ÙˆÙØ§Øª Ù…ÙƒØªØ¨ÙŠØ©"></td>
                    <td>
                        <select class="type-select">
                            <option value="Ù…ÙˆØ¸ÙÙŠÙ†">Ù…ÙˆØ¸ÙÙŠÙ†</option>
        <option value="Ù…Ø¹Ù„Ù‚Ø§Øª">Ù…Ø¹Ù„Ù‚Ø§Øª</option>
        <option value="Ø³Ø¯Ø§Ø¯ Ù…ÙˆØ±Ø¯ÙŠÙ†">Ø³Ø¯Ø§Ø¯ Ù…ÙˆØ±Ø¯ÙŠÙ†</option>
        <option value="Ù…ØµØ±ÙˆÙØ§Øª">Ù…ØµØ±ÙˆÙØ§Øª</option>
        <option value="Ø§Ù„Ù…Ø¯ÙŠØ±">Ø§Ù„Ù…Ø¯ÙŠØ±</option>
        <option value="ÙÙˆØ§ØªÙŠØ± Ù…Ø´ØªØ±ÙŠØ§Øª">ÙÙˆØ§ØªÙŠØ± Ù…Ø´ØªØ±ÙŠØ§Øª</option>
        <option value="Ù†Ù‚Ø¯ÙŠÙ‡">Ù†Ù‚Ø¯ÙŠÙ‡</option>
        <option value="Ø§Ø®Ø±Ù‰">Ø§Ø®Ø±Ù‰</option>
        <option value="Ù…Ø³Ø³Ù„Ù… Ù…Ø¹Ù„Ù‚Ø§Øª Ø³Ø§Ø¨Ù‚Ù‡">Ù…Ø³Ø³Ù„Ù… Ù…Ø¹Ù„Ù‚Ø§Øª Ø³Ø§Ø¨Ù‚Ù‡</option>
                        </select>
                    </td>
                    <td><input type="number" class="exchange-input" value="1" step="0.01" disabled></td>
                    <td class="total-cell">1000.00</td>
                    <td class="attachment-cell">
                        <button class="attachment-btn">
                            <i class="fas fa-paperclip"></i>
                        </button>
                        <input type="file" class="attachment-input" accept="image/*,.pdf">
                        <img class="attachment-preview" style="display:none">
                    </td>
                    <td class="action-buttons">
                        <button class="action-btn delete"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tableBody.appendChild(newRow);
                
                // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„
                addRowEvents(newRow);
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
                document.getElementById('employee-name').value = '';
                document.getElementById('employee-note').value = ''; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
                document.getElementById('movement-date').valueAsDate = new Date();
                document.getElementById('required-amount').value = '';
                document.getElementById('suspended-total').textContent = '0.00 Ø±ÙŠØ§Ù„';
                document.getElementById('serial-number').textContent = '1';
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ù„Ø®Øµ
                updateSummary();
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
                document.getElementById('analytics-section').innerHTML = `
                    <div class="input-section">
                        <h2 style="text-align: center; color: var(--primary); margin: 50px 0;">
                            <i class="fas fa-database"></i> Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ© Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
                        </h2>
                        <p style="text-align: center;">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø£ÙˆÙ„Ø§Ù‹</p>
                    </div>
                `;
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
                localStorage.setItem('nextId', 1);
                
                alert('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
            }
        }
        
        // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
        const sampleData = [
            {
                id: 1,
                employeeName: "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯",
                note: "Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£ÙˆÙ„ÙŠØ©",
                date: "2023-10-15",
                movements: [
                    { amount: 1000, currency: "YER", description: "Ù…ØµØ±ÙˆÙØ§Øª Ù…ÙƒØªØ¨ÙŠØ©", type: "ÙÙˆØ§ØªÙŠØ± Ù…Ø´ØªØ±ÙŠØ§Øª", exchangeRate: 1, total: 1000 },
                    { amount: 200, currency: "USD", description: "Ø´Ø±Ø§Ø¡ Ø¨Ø±Ù…Ø¬ÙŠØ§Øª", type: "ÙÙˆØ§ØªÙŠØ± Ù…Ø´ØªØ±ÙŠØ§Øª", exchangeRate: 250, total: 50000 },
                    { amount: 500, currency: "SAR", description: "Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø·Ø§Ø¨Ø¹Ø©", type: "ÙÙˆØ§ØªÙŠØ± Ù…Ø´ØªØ±ÙŠØ§Øª", exchangeRate: 66.5, total: 33250 }
                ],
                totalAmount: 84250,
                requiredAmount: 84250,
                difference: 0,
                status: "match",
                suspendedTotal: 0
            },
            {
                id: 2,
                employeeName: "Ø³Ø§Ø±Ø© Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡",
                note: "Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø«Ø§Ù†ÙŠØ©",
                date: "2023-10-16",
                movements: [
                    { amount: 1500, currency: "YER", description: "ÙˆÙ‚ÙˆØ¯ Ø³ÙŠØ§Ø±Ø©", type: "Ù…Ø¹Ù„Ù‚Ø§Øª", exchangeRate: 1, total: 1500 },
                    { amount: 300, currency: "USD", description: "Ø£Ø¯ÙˆØ§Øª Ù…ÙƒØªØ¨ÙŠØ©", type: "ÙÙˆØ§ØªÙŠØ± Ù…Ø´ØªØ±ÙŠØ§Øª", exchangeRate: 250, total: 75000 }
                ],
                totalAmount: 76500,
                requiredAmount: 76000,
                difference: 500,
                status: "excess",
                suspendedTotal: 0
            }
        ];
        
        // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®
        function filterByDate() {
            const start = document.getElementById('startDate').value;
            const end = document.getElementById('endDate').value;
            if (!start || !end) {
                alert('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠÙ†.');
                return;
            }
            const savedMovements = JSON.parse(localStorage.getItem('movements')) || [];
            const filtered = savedMovements.filter(movement => {
                const movementDate = new Date(movement.date);
                return movementDate >= new Date(start) && movementDate <= new Date(end);
            });
            loadSavedMovements(filtered);
        }
        
        function setPeriod(type) {
            const now = new Date();
            let start, end;
            if (type === 'month') {
                start = new Date(now.getFullYear(), now.getMonth(), 1);
                end = new Date(now.getFullYear(), now.getMonth() + 1, 0);
            } else if (type === 'quarter') {
                const quarter = Math.floor((now.getMonth() + 3) / 3);
                start = new Date(now.getFullYear(), (quarter - 1) * 3, 1);
                end = new Date(now.getFullYear(), quarter * 3, 0);
            } else if (type === 'year') {
                start = new Date(now.getFullYear(), 0, 1);
                end = new Date(now.getFullYear(), 11, 31);
            }
            document.getElementById('startDate').valueAsDate = start;
            document.getElementById('endDate').valueAsDate = end;
            filterByDate();
        }
        
        // Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        function generateDashboardCharts() {
            const savedMovements = JSON.parse(localStorage.getItem("movements")) || [];
            if (savedMovements.length === 0) return;
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
            const currencyData = { YER: 0, SAR: 0, USD: 0 };
            savedMovements.forEach(movement => {
                movement.movements.forEach(item => {
                    currencyData[item.currency] += item.amount;
                });
            });
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø®Ø·Ø· ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
            const currencyCtx = document.getElementById('dashboard-currency-chart').getContext('2d');
            new Chart(currencyCtx, {
                type: 'pie',
                data: {
                    labels: ['Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ', 'Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ', 'Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ'],
                    datasets: [{
                        data: [currencyData.YER, currencyData.SAR, currencyData.USD],
                        backgroundColor: ['#3498db', '#2ecc71', '#9b59b6']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            rtl: true
                        }
                    }
                }
            });
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ
            const monthNames = [
                'ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ',
                'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'
            ];
            
            const activityData = Array(12).fill(0);
            savedMovements.forEach(movement => {
                const month = new Date(movement.date).getMonth();
                activityData[month]++;
            });
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø®Ø·Ø· Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ
            const activityCtx = document.getElementById('dashboard-activity-chart').getContext('2d');
            new Chart(activityCtx, {
                type: 'line',
                data: {
                    labels: monthNames,
                    datasets: [{
                        label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø±ÙƒØ§Øª',
                        data: activityData,
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(52, 152, 219, 1)',
                        pointRadius: 4,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
        }
    
        // === ÙÙ„ØªØ±Ø© ÙÙˆØ±ÙŠØ© Ø­Ø³Ø¨ "Ø§Ù„Ù†ÙˆØ¹" ÙÙŠ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© (Ù„Ø§ ØªÙ…Ø³ Ø¨Ù‚ÙŠØ© Ø§Ù„Ù†Ø¸Ø§Ù…) ===
        function attachTypeFilterForDetailed() {
            const input = document.getElementById('filterTypeDetailed');
            const table = document.getElementById('detailed-reports-table');
            if (!input || !table) return;
            input.addEventListener('input', function() {
                const q = this.value.toLowerCase().trim();
                const rows = table.querySelectorAll('tbody tr');
                rows.forEach(tr => {
                    const typeCell = tr.children[6]; // Ø¹Ù…ÙˆØ¯ "Ø§Ù„Ù†ÙˆØ¹" Ø­Ø³Ø¨ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                    const text = (typeCell ? typeCell.textContent : '').toLowerCase();
                    tr.style.display = (!q || text.includes(q)) ? '' : 'none';
                });
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙÙ„ØªØ± Ø¥Ù† ÙˆØ¬Ø¯
                const totalSpan = document.getElementById('filtered-total');
                if (totalSpan) {
                    let sum = 0;
                    const totalIndex = 8; // Ø¹Ù…ÙˆØ¯ "Ø§Ù„Ø§Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„ÙŠÙ…Ù†ÙŠ" Ø­Ø³Ø¨ Ø§Ù„ØªØ±ØªÙŠØ¨
                    rows.forEach(tr => {
                        if (tr.style.display !== 'none') {
                            const cell = tr.children[totalIndex];
                            if (cell) {
                                const num = parseFloat(cell.textContent.replace(/[,\s]/g, '')) || 0;
                                sum += num;
                            }
                        }
                    });
                    totalSpan.textContent = sum.toFixed(2);
                }
            });
        }
        document.addEventListener('DOMContentLoaded', attachTypeFilterForDetailed);
        
        // === Ø¯Ø§Ù„Ø© Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø© ÙÙŠ Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ===
        function printFilteredMovements() {
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙÙ„ØªØ±
            const table = document.getElementById('saved-movements-table');
            const rows = table.querySelectorAll('tbody tr');
            
            if (rows.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©');
                return;
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ø·Ø¨Ø§Ø¹Ø©
            const printWin = window.open('', '_blank', 'width=900,height=700');
            printWin.document.write(`
                <html>
                <head>
                    <title>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø©</title>
                    <style>
                        body { font-family: 'Tajawal', sans-serif; direction: rtl; margin: 30px; }
                        h2 { text-align: center; color: #007bff; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #000; padding: 8px; text-align: center; }
                        th { background-color: #f2f2f2; }
                        .print-header { text-align: center; margin-bottom: 20px; }
                        .print-footer { text-align: center; margin-top: 40px; font-style: italic; color: #666; }
                    
.app-container.collapsed .sidebar {
    width: 60px;
}
.app-container.collapsed .main-content {
    margin-right: 60px;
}
.app-container.collapsed .sidebar-header h2 span,
.app-container.collapsed .dept-item span,
.app-container.collapsed .user-info {
    display: none;
}

</style>
                </head>
                <body>
                    <div class="print-header">
                        <h2>ÙƒØ´Ù Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…ÙÙ„ØªØ±Ø©</h2>
                        <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${new Date().toLocaleDateString('ar-YE')}</p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„</th>
                                <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù…Ù†Ù‡</th>
                                <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„ÙŠÙ…Ù†ÙŠ</th>
                                <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            </tr>
                        </thead>
                        <tbody>
            `);
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙÙˆÙ
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                printWin.document.write(`
                    <tr>
                        <td>${cells[0].textContent}</td>
                        <td>${cells[1].textContent}</td>
                        <td>${cells[2].textContent}</td>
                        <td>${cells[3].textContent}</td>
                        <td>${cells[4].textContent}</td>
                        <td>${cells[5].textContent}</td>
                        <td>${cells[6].textContent}</td>
                        <td>${cells[7].innerHTML}</td>
                    </tr>
                `);
            });
            
            printWin.document.write(`
                        </tbody>
                    </table>
                    <div class="print-footer">
                        <p>Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© - Ø¨Ø±Ù…Ø¬Ø© ÙˆØªØ·ÙˆÙŠØ± / Ø¬Ø§ÙˆØ¯ Ø§Ù„Ø­ÙŠØ¯Ø±ÙŠ</p>
                    </div>
                </body>
                </html>
            `);
            printWin.document.close();
            printWin.print();
        }
        
        // === Ø¯Ø§Ù„Ø© Ù„ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø¥Ù„Ù‰ PDF ===
        function exportAllToPDF() {
            const savedMovements = JSON.parse(localStorage.getItem('movements')) || [];
            if (savedMovements.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù„ØªØµØ¯ÙŠØ±');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            doc.setFontSize(16);
            doc.text('ØªÙ‚Ø±ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø±ÙƒØ§Øª', 105, 15, null, null, 'center');
            doc.setFontSize(12);
            doc.text(`ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØµØ¯ÙŠØ±: ${new Date().toLocaleDateString('ar-YE')}`, 15, 25);
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            const headers = ['Ø§Ù„Ø±Ù‚Ù…', 'Ø§Ù„Ù…ÙˆØ¸Ù', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª', 'Ø§Ù„Ù…Ø·Ù„ÙˆØ¨', 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ', 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù…', 'Ø§Ù„Ø­Ø§Ù„Ø©', 'Ø§Ù„ÙØ±Ù‚'];
            const data = [];
            
            savedMovements.forEach((movement, index) => {
                const status = movement.status === 'match' ? 'Ù…Ø·Ø§Ø¨Ù‚' : 
                              movement.status === 'excess' ? 'Ø²ÙŠØ§Ø¯Ø©' : 'Ù†Ù‚Øµ';
                data.push([
                    movement.id,
                    movement.employeeName,
                    movement.date,
                    movement.note || "â€”", // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
                    movement.requiredAmount.toFixed(2),
                    movement.totalAmount.toFixed(2),
                    movement.suspendedTotal.toFixed(2),
                    status,
                    movement.difference.toFixed(2)
                ]);
            });
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            doc.autoTable({
                startY: 30,
                head: [headers],
                body: data,
                theme: 'grid',
                headStyles: { 
                    fillColor: [44, 62, 80],
                    textColor: 255,
                    fontStyle: 'bold'
                },
                styles: { 
                    font: 'Tajawal',
                    fontStyle: 'normal',
                    textColor: [0, 0, 0],
                    cellPadding: 3,
                    fontSize: 10
                },
                margin: { right: 10, left: 10 }
            });
            
            // ØªØ°ÙŠÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(10);
                doc.text('Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© - Ø¨Ø±Ù…Ø¬Ø© ÙˆØªØ·ÙˆÙŠØ± / Ø¬Ø§ÙˆØ¯ Ø§Ù„Ø­ÙŠØ¯Ø±ÙŠ', 105, doc.internal.pageSize.height - 10, null, null, 'center');
            }
            
            // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù
            doc.save('Ø¬Ù…ÙŠØ¹_Ø§Ù„Ø­Ø±ÙƒØ§Øª.pdf');
        }
        
        document.getElementById("print-input-table-btn").addEventListener("click", function () {
            const employeeName = document.getElementById("employee-name").value || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
            const note = document.getElementById("employee-note").value || "â€”"; // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
            const movementDate = document.getElementById("movement-date").value || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
            const serialNumber = document.getElementById("serial-number").textContent || "1";
            const totalAmount = document.getElementById("total-amount").textContent || "0.00 Ø±ÙŠØ§Ù„";
            const requiredAmount = document.getElementById("required-amount").value || "0.00";
            const differenceAmount = document.getElementById("difference-amount").textContent || "0.00 Ø±ÙŠØ§Ù„";
            const status = document.getElementById("status-box").textContent || "";
            const suspendedTotal = document.getElementById("suspended-total").textContent || "0.00 Ø±ÙŠØ§Ù„";

            let html = `
            <div class="print-header">
                <h2>ØªÙ‚Ø±ÙŠØ± Ø­Ø±ÙƒØ© Ø§Ù„Ù…ÙˆØ¸Ù</h2>
                <p>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù: <strong>${employeeName}</strong></p>
                <p>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª: <strong>${note}</strong></p> <!-- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ù†Ø§ -->
                <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø±ÙƒØ©: <strong>${movementDate}</strong></p>
                <p>Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„: <strong>${serialNumber}</strong></p>
            </div>
            <table class="print-table">
                <thead>
                    <tr>
                        <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                        <th>Ø§Ù„Ø¹Ù…Ù„Ø©</th>
                        <th>Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                        <th>Ø§Ù„Ù†ÙˆØ¹</th>
                        <th>Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù</th>
                        <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„ÙŠÙ…Ù†ÙŠ</th>
                    </tr>
                </thead>
                <tbody>
            `;

            const rows = document.querySelectorAll("#movements-body tr");
            rows.forEach(row => {
                const amount = row.querySelector(".amount-input").value || "0";
                const currency = row.querySelector(".currency-select").value;
                const desc = row.querySelector(".description-input").value || "";
                const type = row.querySelector(".type-select")?.value || "";
                const exchange = row.querySelector(".exchange-input").value || "";
                const total = row.querySelector(".total-cell").textContent || "0";

                html += `
                <tr>
                    <td>${amount}</td>
                    <td>${currency}</td>
                    <td>${desc}</td>
                    <td>${type}</td>
                    <td>${exchange}</td>
                    <td>${total}</td>
                </tr>`;
            });

            html += `</tbody></table>

            
        <table class="print-table">
            <thead>
                <tr>
                    <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø±ÙƒØ§Øª</th>
                    <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</th>
                    <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙØ§Ø±Ù‚</th>
                    <th>Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§Ø±Ù‚</th>
                    <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø§Øª</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>${totalAmount}</td>
                    <td>${requiredAmount} Ø±ÙŠØ§Ù„</td>
                    <td>${differenceAmount}</td>
                    <td>${status}</td>
                    <td>${suspendedTotal}</td>
                </tr>
            </tbody>
        </table>


            <div class="print-footer">Ø¨Ø±Ù…Ø¬Ø© ÙˆØªØ·ÙˆÙŠØ± / Ø¬Ø§ÙˆØ¯ Ø§Ù„Ø­ÙŠØ¯Ø±ÙŠ</div>`;

            const printContent = document.getElementById("print-content");
            printContent.innerHTML = html;

            document.getElementById("print-window").style.display = "block";
            setTimeout(() => {
                window.print();
            }, 500);
        });

document.getElementById("toggle-sidebar").addEventListener("click", function () {
    document.querySelector(".app-container").classList.toggle("collapsed");
});


// Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª LocalStorage
function manualBackup() {
    const data = JSON.stringify(localStorage);
    const blob = new Blob([data], { type: "application/json" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "backup.json";
    link.click();
}

// Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù†Ø³Ø®Ø© JSON
function manualRestore(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const restoredData = JSON.parse(e.target.result);
            Object.keys(restoredData).forEach(key => {
                localStorage.setItem(key, restoredData[key]);
            });
            alert("âœ… ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
            location.reload();
        } catch (err) {
            alert("âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ù„Ù ØµØ§Ù„Ø­.");
        }
    };
    reader.readAsText(file);
}

// Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù…ØªØµÙØ­
window.addEventListener("load", function() {
    const data = JSON.stringify(localStorage);
    const blob = new Blob([data], { type: "application/json" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "auto-backup-" + new Date().toISOString().slice(0,19).replace(/:/g, "-") + ".json";
    link.click();
});

function manualBackup() {
    const data = JSON.stringify(localStorage);
    const blob = new Blob([data], { type: "application/json" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "backup.json";
    link.click();
}

function manualRestore(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const restoredData = JSON.parse(e.target.result);
            Object.keys(restoredData).forEach(key => {
                localStorage.setItem(key, restoredData[key]);
            });
            alert("âœ… ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
            location.reload();
        } catch (err) {
            alert("âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ù„Ù ØµØ§Ù„Ø­.");
        }
    };
    reader.readAsText(file);
}

function manualBackup() {
    const data = JSON.stringify(localStorage);
    const blob = new Blob([data], { type: "application/json" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "backup.json";
    link.click();
}

function manualRestore(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const restoredData = JSON.parse(e.target.result);
            Object.keys(restoredData).forEach(key => {
                localStorage.setItem(key, restoredData[key]);
            });
            alert("âœ… ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
            location.reload();
        } catch (err) {
            alert("âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ù„Ù ØµØ§Ù„Ø­.");
        }
    };
    reader.readAsText(file);
}

// Ù†Ø³Ø®Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù…ØªØµÙØ­
window.addEventListener("load", () => {
    const data = JSON.stringify(localStorage);
    const blob = new Blob([data], { type: "application/json" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "backup_auto.json";
    link.style.display = "none";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
});
</script>
<div id="backup-section" style="max-width:600px;margin:50px auto;text-align:center;padding:20px;background-color:#f9f9f9;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.1);"><h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h2><p>Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ùˆ Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡Ø§ØŒ Ø£Ùˆ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ.</p><button onclick="manualBackup()" style="margin: 10px; background-color: green; color: white; padding: 10px 20px; border: none; border-radius: 5px;">ğŸ’¾ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button><input id="manualRestoreInput" onchange="manualRestore(event)" style="display:none" type="file"/><button onclick="document.getElementById('manualRestoreInput').click()" style="margin: 10px; background-color: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px;">ğŸ“‚ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø©</button><button onclick="manualBackup()" style="margin: 10px; background-color: #555; color: white; padding: 10px 20px; border: none; border-radius: 5px;">ğŸ•“ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù…ØªØµÙØ­</button></div><div id="monthly-summaries" style="max-width: 1000px; margin: 0 auto;"><h2 style="margin: 30px 0; color: var(--primary);">ğŸ“† Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ ÙˆØ§Ù„Ø¨ÙŠØ§Ù† ÙˆØ§Ù„Ø¹Ù…Ù„Ù‡</h2>
<div style="margin: 20px 0;">
<label style="font-weight: bold;">ğŸ“… Ø§Ø®ØªØ± Ø§Ù„Ø´Ù‡Ø±:</label>
<select class="type-select" id="month-selector" style="width: 300px; margin-right: 10px;">
<option value="">Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù…ÙŠØ¹</option>
</select>
</div>
<div style="margin: 20px 0;">
<button onclick="printVisibleMonth()" style="padding: 8px 16px; background-color: #2980b9; color: white; border: none; border-radius: 6px; cursor: pointer;">
        ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø¸Ø§Ù‡Ø±
    </button>
</div>
</div><script>
function groupByMonthAndSummarize() {
    const data = JSON.parse(localStorage.getItem("movements") || "[]");
    const container = document.getElementById("monthly-summaries");
    const monthSelect = document.getElementById("month-selector");

    const monthGroups = {};

    data.forEach(entry => {
        const date = new Date(entry.date);
        const monthKey = date.toLocaleString('ar-EG', { month: 'long', year: 'numeric' });

        if (!monthGroups[monthKey]) monthGroups[monthKey] = [];

        monthGroups[monthKey].push(...entry.movements.map(m => ({
            ...m,
            total: parseFloat(m.total) || 0
        })));
    });

    const sortedMonths = Object.keys(monthGroups).sort((a, b) => new Date("1 " + a) - new Date("1 " + b));
    sortedMonths.forEach(month => {
        const option = document.createElement("option");
        option.value = month;
        option.textContent = month;
        monthSelect.appendChild(option);
    });

    function renderMonth(selectedMonth) {
        document.querySelectorAll(".month-summary-block").forEach(e => e.remove());

        for (const [month, items] of Object.entries(monthGroups)) {
            if (selectedMonth && selectedMonth !== month) continue;

            const typeStats = {};
            const descStats = {};
            const currencyStats = {};

            items.forEach(item => {
                const type = item.type || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
                const desc = item.description || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
                const curr = item.currency || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©";
                const total = item.total;

                if (!typeStats[type]) typeStats[type] = { count: 0, total: 0 };
                typeStats[type].count += 1;
                typeStats[type].total += total;

                if (!descStats[desc]) descStats[desc] = { count: 0, total: 0 };
                descStats[desc].count += 1;
                descStats[desc].total += total;

                if (!currencyStats[curr]) currencyStats[curr] = { count: 0, total: 0 };
                currencyStats[curr].count += 1;
                currencyStats[curr].total += total;
            });

            const monthSection = document.createElement("div");
            monthSection.className = "month-summary-block";
            monthSection.style.marginBottom = "40px";
            monthSection.innerHTML = `
                <h3 style="color: #2980b9; margin-top: 25px;">ğŸ“… ${month}</h3>
                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 280px;">
                        <h4 style="color: #2c3e50;">ğŸ”¸ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹</h4>
                        <table class="movements-table" style="margin-bottom: 20px;">
                            <thead><tr><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø¹Ø¯Ø¯</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th></tr></thead>
                            <tbody>
                                ${Object.entries(typeStats).map(([t, d]) => `
                                    <tr><td>${t}</td><td>${d.count}</td><td>${d.total.toFixed(2)} Ø±ÙŠØ§Ù„</td></tr>
                                `).join("")}
                            </tbody>
                        </table>
                    </div>
                    <div style="flex: 1; min-width: 280px;">
                        <h4 style="color: #2c3e50;">ğŸ”¹ Ø­Ø³Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†</h4>
                        <table class="movements-table" style="margin-bottom: 20px;">
                            <thead><tr><th>Ø§Ù„Ø¨ÙŠØ§Ù†</th><th>Ø¹Ø¯Ø¯</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th></tr></thead>
                            <tbody>
                                ${Object.entries(descStats).map(([t, d]) => `
                                    <tr><td>${t}</td><td>${d.count}</td><td>${d.total.toFixed(2)} Ø±ÙŠØ§Ù„</td></tr>
                                `).join("")}
                            </tbody>
                        </table>
                    </div>
                    <div style="flex: 1; min-width: 280px;">
                        <h4 style="color: #2c3e50;">ğŸ’± Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø©</h4>
                        <table class="movements-table">
                            <thead><tr><th>Ø§Ù„Ø¹Ù…Ù„Ø©</th><th>Ø¹Ø¯Ø¯</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th></tr></thead>
                            <tbody>
                                ${Object.entries(currencyStats).map(([t, d]) => `
                                    <tr><td>${t}</td><td>${d.count}</td><td>${d.total.toFixed(2)} Ø±ÙŠØ§Ù„</td></tr>
                                `).join("")}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            container.appendChild(monthSection);
        }
    }

    renderMonth("");
    monthSelect.addEventListener("change", () => {
        renderMonth(monthSelect.value);
    });
}

function printVisibleMonth() {
    const summaries = document.querySelectorAll(".month-summary-block");
    summaries.forEach(el => el.style.display = "none");

    const selectedMonth = document.getElementById("month-selector").value;
    let printed = false;

    summaries.forEach(el => {
        if (!selectedMonth || el.querySelector("h3").textContent.includes(selectedMonth)) {
            el.style.display = "block";
            printed = true;
        }
    });

    if (printed) {
        window.print();
    } else {
        alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø´Ù‡Ø± Ù„Ø·Ø¨Ø§Ø¹ØªÙ‡.");
    }

    setTimeout(() => {
        summaries.forEach(el => el.style.display = "block");
    }, 1000);
}

window.addEventListener("load", groupByMonthAndSummarize);
</script></body>
</html>